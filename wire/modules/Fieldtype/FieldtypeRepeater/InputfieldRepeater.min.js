function InputfieldRepeaterDeleteClick(d){var c=$(this).parent("label").parent("li");if(c.is(".InputfieldRepeaterNewItem")){var a=c.parent().parent().find(".InputfieldRepeaterAddItem").children("input");a.attr("value",parseInt(a.attr("value")-1));c.remove()}else{var b=c.find(".InputfieldRepeaterDelete");if(b.is(":checked")){b.removeAttr("checked");c.children("label").removeClass("ui-state-error").addClass("ui-state-default");c.removeClass("InputfieldRepeaterDeletePending")}else{b.attr("checked","checked");c.children("label").removeClass("ui-state-default").addClass("ui-state-error");if(!c.hasClass("InputfieldStateCollapsed")){c.toggleClass("InputfieldStateCollapsed",100)}c.addClass("InputfieldRepeaterDeletePending")}}d.stopPropagation()}function InputfieldRepeaterToggleClick(f){var d=$(this);var c=d.attr("data-on");var a=d.attr("data-off");var b=d.closest(".InputfieldRepeaterItem");var g=b.find(".InputfieldRepeaterPublish");if(d.hasClass(c)){d.removeClass(c).addClass(a);b.addClass("InputfieldRepeaterUnpublished InputfieldRepeaterOff");g.val("-1")}else{d.removeClass(a).addClass(c);b.removeClass("InputfieldRepeaterUnpublished InputfieldRepeaterOff");g.val("1")}f.stopPropagation()}function InputfieldRepeaterItemOpenReady(c){var a=$(this);var b=a.find(".InputfieldRepeaterLoaded");if(parseInt(b.val())>0){return}a.addClass("InputfieldRepeaterItemLoading")}function InputfieldRepeaterUpdateState(a){if(!a.closest(".InputfieldRepeaterRememberOpen").length){return}var b="";$(".InputfieldRepeaterItem:not(.InputfieldStateCollapsed)").each(function(){var c=parseInt($(this).attr("data-page"));if(c>0){b+=c+"|"}});$.cookie("repeaters_open",b)}function InputfieldRepeaterItemClosed(a){InputfieldRepeaterUpdateState($(this))}function InputfieldRepeaterItemOpened(h){var j=$(this);var m=j.find(".InputfieldRepeaterLoaded");InputfieldRepeaterUpdateState(j);if(parseInt(m.val())>0){return}m.val("1");var b=j.find(".InputfieldContent").hide();var d=j.closest(".InputfieldRepeater");var i=d.attr("data-page");var c=parseInt(j.attr("data-page"));var l=d.attr("id");var k=l.replace("wrap_Inputfield_","");var a=ProcessWire.config.InputfieldRepeater.editorUrl+"?id="+i+"&field="+k+"&repeater_edit="+c;var f=j.find(".InputfieldRepeaterDrag");var g=m.closest(".Inputfields");f.removeClass("fa-arrows").addClass("fa-spin fa-spinner");l=l.replace(/_repeater\d+$/,"");$.get(a,function(o){var e=$(o).find("#"+l+" > .InputfieldContent > .Inputfields > .InputfieldRepeaterItem > .InputfieldContent > .Inputfields > .InputfieldWrapper > .Inputfields > .Inputfield");g.append(e);j.removeClass("InputfieldRepeaterItemLoading");InputfieldsInit(g);var n=e.filter(".InputfieldRepeater");if(n.length){n.each(function(){InputfieldRepeaterInit($(this))})}b.slideDown("fast",function(){f.removeClass("fa-spin fa-spinner").addClass("fa-arrows")});setTimeout(function(){g.find(".Inputfield").trigger("reloaded",["InputfieldRepeaterItemEdit"])},50)})}function InputfieldRepeaterAdjustLabel(c,d){var b=c.children("label");var e=b.html();var a=e;if(d&&e.indexOf("#")>-1){num=c.siblings(".InputfieldRepeaterItem:visible").length+1;e=e.replace(/#[0-9]+/,"#"+num)}if(e.indexOf("{")>-1){e=e.replace(/\{/,'<span class="ui-priority-secondary" style="font-weight:normal">');e=e.replace(/}/,"</span>")}if(e!=a){b.html(e)}}function InputfieldRepeaterInit(g){if(g.hasClass("InputfieldRepeaterItem")){var d=g;var c=true}else{var d=g.find(".Inputfields:eq(0)");var c=false}if(d.hasClass("InputfieldRepeaterInit")){return}d.addClass("InputfieldRepeaterInit");var b=d.closest(".InputfieldRenderValueMode").length>0;var e=$("<i class='fa fa-trash InputfieldRepeaterTrash'></i>").css("display","block");var a=$("<i class='fa InputfieldRepeaterToggle' data-on='fa-toggle-on' data-off='fa-toggle-off'></i>");var f=ProcessWire.config.InputfieldRepeater;if(f){a.attr("title",f.labels.toggle);e.attr("title",f.labels.remove)}$("input.InputfieldRepeaterDelete",g).parents(".InputfieldCheckbox").hide();function h(j){j.each(function(){var m=$(this);if(m.hasClass("InputfieldRepeaterHeaderInit")){return}var l="fa-arrows";var k=m.parent();if(k.hasClass("InputfieldRepeaterNewItem")){l="fa-plus";m.addClass("ui-priority-secondary")}m.addClass("ui-state-default InputfieldRepeaterHeaderInit");m.prepend("<i class='fa fa-fw "+l+" InputfieldRepeaterDrag'></i>");if(!b){m.prepend(a.clone(true).addClass(m.parent().hasClass("InputfieldRepeaterOff")?"fa-toggle-off":"fa-toggle-on"));m.prepend(e.clone(true))}InputfieldRepeaterAdjustLabel(k,false)})}if(c){h(g.children(".InputfieldHeader"))}else{h($(".InputfieldRepeaterItem > .InputfieldHeader",g))}if(b){return}$(".InputfieldRepeaterDrag",g).hover(function(){$(this).parent("label").addClass("ui-state-focus")},function(){$(this).parent("label").removeClass("ui-state-focus")});$(".InputfieldRepeaterTrash",g).hover(function(){var j=$(this).parent("label");if(!j.parent().is(".InputfieldRepeaterDeletePending")){j.addClass("ui-state-error")}},function(){var j=$(this).parent("label");if(!j.parent().is(".InputfieldRepeaterDeletePending")){j.removeClass("ui-state-error")}});if(c){d=g.closest(".InputfieldRepeater").find(".Inputfields:eq(0)")}d.sortable({items:"> li:not(.InputfieldRepeaterNewItem)",axis:"y",handle:".InputfieldRepeaterDrag",start:function(k,j){j.item.find(".InputfieldHeader").addClass("ui-state-highlight");j.item.find("textarea.InputfieldCKEditorNormal.InputfieldCKEditorLoaded").each(function(){$(this).removeClass("InputfieldCKEditorLoaded");var l=CKEDITOR.instances[$(this).attr("id")];l.destroy();CKEDITOR.remove($(this).attr("id"))});j.item.find(".InputfieldTinyMCE textarea").each(function(){tinyMCE.execCommand("mceRemoveControl",false,$(this).attr("id"))})},stop:function(k,j){j.item.find(".InputfieldHeader").removeClass("ui-state-highlight");$(this).children().each(function(l){$(this).find(".InputfieldRepeaterSort").slice(0,1).attr("value",l)});j.item.find("textarea.InputfieldCKEditorNormal:not(.InputfieldCKEditorLoaded)").each(function(){$(this).closest(".InputfieldCKEditor").trigger("reloaded",["InputfieldRepeaterSort"])});j.item.find(".InputfieldTinyMCE textarea").each(function(){tinyMCE.execCommand("mceAddControl",false,$(this).attr("id"))})}});var i=$(".InputfieldRepeaterAddLink:not(.InputfieldRepeaterAddLinkInit)",g);i.addClass("InputfieldRepeaterAddLinkInit");i.click(function(){var k=$(this);var q=$(this).parent("p").prev("ul.Inputfields");var l=$(this).parent().children("input");var p=0;function s(v){var w=v.attr("id")+"_";while($("#"+w).size()>0){w+="_"}v.attr("id",w);q.append(v);v.css("display","block");InputfieldRepeaterAdjustLabel(v,true);k.trigger("repeateradd",[v])}var u=k.attr("data-noajax").length==0;if(!u){var m=q.children(".InputfieldRepeaterNewItem");p=m.length;if(p>0){if(p>1){m=m.slice(0,1)}var o=m.clone(true);s(o);l.attr("value",p)}}else{var r=k.closest(".InputfieldRepeater").attr("data-page");var t=k.closest(".InputfieldRepeater").attr("id").replace("wrap_Inputfield_","");var j=ProcessWire.config.InputfieldRepeater.editorUrl+"?id="+r+"&field="+t+"&repeater_add="+k.attr("data-type")+"&repeater_not=";var n=k.parent().find(".InputfieldRepeaterSpinner");n.removeClass(n.attr("data-off")).addClass(n.attr("data-on"));q.find(".InputfieldRepeaterUnpublished").each(function(){j+=$(this).attr("data-page")+","});$.get(j,function(w){n.removeClass(n.attr("data-on")).addClass(n.attr("data-off"));var v=$(w).find(".InputfieldRepeaterItem.InputfieldRepeaterUnpublished");if(!v.length){return}s(v);v.wrap("<div />");InputfieldsInit(v.parent());InputfieldRepeaterInit(v);v.unwrap();v.find(".Inputfield").trigger("reloaded",["InputfieldRepeaterItemAdd"]);v.find(".InputfieldRepeaterSort").val(q.children().length);$("html, body").animate({scrollTop:v.offset().top},500);InputfieldRepeaterUpdateState(v)})}return false})}$(document).ready(function(){$(".InputfieldRepeater").each(function(){InputfieldRepeaterInit($(this))});$(document).on("reloaded",".InputfieldRepeater",function(b,c){if(typeof c!="undefined"){if(c=="InputfieldRepeaterItemEdit"||c=="InputfieldRepeaterItemAdd"){b.stopPropagation();var a=$(this).find(".InputfieldRepeater");if(a.length){InputfieldRepeaterInit(a)}return}}InputfieldRepeaterInit($(this))});$(document).on("click",".InputfieldRepeaterTrash",InputfieldRepeaterDeleteClick);$(document).on("click",".InputfieldRepeaterToggle",InputfieldRepeaterToggleClick);$(document).on("opened",".InputfieldRepeaterItem",InputfieldRepeaterItemOpened);$(document).on("closed",".InputfieldRepeaterItem",InputfieldRepeaterItemClosed);$(document).on("openReady",".InputfieldRepeaterItem",InputfieldRepeaterItemOpenReady)});