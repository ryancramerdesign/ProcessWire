function InputfieldRepeaterDeleteClick(d){var c=$(this).parent("label").parent("li");if(c.is(".InputfieldRepeaterNewItem")){var a=c.parent().parent().find(".InputfieldRepeaterAddItem").children("input");a.attr("value",parseInt(a.attr("value")-1));c.remove()}else{var b=c.find(".InputfieldRepeaterDelete");if(b.is(":checked")){b.removeAttr("checked");c.children("label").removeClass("ui-state-error").addClass("ui-state-default");c.removeClass("InputfieldRepeaterDeletePending")}else{b.attr("checked","checked");c.children("label").removeClass("ui-state-default").addClass("ui-state-error");if(!c.hasClass("InputfieldStateCollapsed")){c.toggleClass("InputfieldStateCollapsed",100)}c.addClass("InputfieldRepeaterDeletePending")}}d.stopPropagation()}function InputfieldRepeaterToggleClick(f){var d=$(this);var c=d.attr("data-on");var a=d.attr("data-off");var b=d.closest(".InputfieldRepeaterItem");var g=b.find(".InputfieldRepeaterPublish");if(d.hasClass(c)){d.removeClass(c).addClass(a);b.addClass("InputfieldRepeaterUnpublished InputfieldRepeaterOff");g.val("-1")}else{d.removeClass(a).addClass(c);b.removeClass("InputfieldRepeaterUnpublished InputfieldRepeaterOff");g.val("1")}f.stopPropagation()}function InputfieldRepeaterItemOpenReady(c){var a=$(this);var b=a.find(".InputfieldRepeaterLoaded");if(parseInt(b.val())>0){return}a.addClass("InputfieldRepeaterItemLoading")}function InputfieldRepeaterItemOpened(h){var j=$(this);var m=j.find(".InputfieldRepeaterLoaded");if(parseInt(m.val())>0){return}m.val("1");var b=j.find(".InputfieldContent").hide();var d=j.closest(".InputfieldRepeater");var i=d.attr("data-page");var c=parseInt(j.attr("data-page"));var l=d.attr("id");var k=l.replace("wrap_Inputfield_","");var a=ProcessWire.config.urls.admin+"page/edit/?id="+i+"&field="+k+"&repeater_edit="+c;var f=j.find(".InputfieldRepeaterDrag");var g=m.closest(".Inputfields");f.removeClass("fa-arrows").addClass("fa-spin fa-spinner");l=l.replace(/_repeater\d+$/,"");$.get(a,function(o){var e=$(o).find("#"+l+" > .InputfieldContent > .Inputfields > .InputfieldRepeaterItem > .InputfieldContent > .Inputfields > .InputfieldWrapper > .Inputfields > .Inputfield");g.append(e);j.removeClass("InputfieldRepeaterItemLoading");InputfieldsInit(g);var n=e.filter(".InputfieldRepeater");if(n.length){n.each(function(){InputfieldRepeaterInit($(this))})}b.slideDown("fast",function(){f.removeClass("fa-spin fa-spinner").addClass("fa-arrows")});setTimeout(function(){g.find(".Inputfield").trigger("reloaded",["InputfieldRepeaterItemEdit"])},50)})}function InputfieldRepeaterAdjustLabel(c,d){var b=c.children("label");var e=b.html();var a=e;if(d&&e.indexOf("#")>-1){num=c.siblings(".InputfieldRepeaterItem:visible").length+1;e=e.replace(/#[0-9]+/,"#"+num)}if(e.indexOf("{")>-1){e=e.replace(/\{/,'<span class="ui-priority-secondary" style="font-weight:normal">');e=e.replace(/}/,"</span>")}if(e!=a){b.html(e)}}function InputfieldRepeaterInit(g){if(g.hasClass("InputfieldRepeaterItem")){var d=g;var f=true}else{var d=g.find(".Inputfields:eq(0)");var f=false}if(d.hasClass("InputfieldRepeaterInit")){return}d.addClass("InputfieldRepeaterInit");var b=$("<i class='fa fa-trash InputfieldRepeaterTrash'></i>").css("display","block");var c=$("<i class='fa InputfieldRepeaterToggle' data-on='fa-toggle-on' data-off='fa-toggle-off'></i>");$("input.InputfieldRepeaterDelete",g).parents(".InputfieldCheckbox").hide();function e(h){h.each(function(){var k=$(this);if(k.hasClass("InputfieldRepeaterHeaderInit")){return}var j="fa-arrows";var i=k.parent();if(i.hasClass("InputfieldRepeaterNewItem")){j="fa-plus";k.addClass("ui-priority-secondary")}k.addClass("ui-state-default InputfieldRepeaterHeaderInit");k.prepend("<i class='fa fa-fw "+j+" InputfieldRepeaterDrag'></i>");k.prepend(c.clone(true).addClass(k.parent().hasClass("InputfieldRepeaterOff")?"fa-toggle-off":"fa-toggle-on"));k.prepend(b.clone(true));InputfieldRepeaterAdjustLabel(i,false)})}if(f){e(g.children(".InputfieldHeader"))}else{e($(".InputfieldRepeaterItem > .InputfieldHeader",g))}$(".InputfieldRepeaterDrag",g).hover(function(){$(this).parent("label").addClass("ui-state-focus")},function(){$(this).parent("label").removeClass("ui-state-focus")});$(".InputfieldRepeaterTrash",g).hover(function(){var h=$(this).parent("label");if(!h.parent().is(".InputfieldRepeaterDeletePending")){h.addClass("ui-state-error")}},function(){var h=$(this).parent("label");if(!h.parent().is(".InputfieldRepeaterDeletePending")){h.removeClass("ui-state-error")}});if(f){d=g.closest(".InputfieldRepeater").find(".Inputfields:eq(0)")}d.sortable({items:"> li:not(.InputfieldRepeaterNewItem)",axis:"y",handle:".InputfieldRepeaterDrag",start:function(i,h){h.item.find(".InputfieldHeader").addClass("ui-state-highlight");h.item.find("textarea.InputfieldCKEditorNormal.InputfieldCKEditorLoaded").each(function(){$(this).removeClass("InputfieldCKEditorLoaded");var j=CKEDITOR.instances[$(this).attr("id")];j.destroy();CKEDITOR.remove($(this).attr("id"))});h.item.find(".InputfieldTinyMCE textarea").each(function(){tinyMCE.execCommand("mceRemoveControl",false,$(this).attr("id"))})},stop:function(i,h){h.item.find(".InputfieldHeader").removeClass("ui-state-highlight");$(this).children().each(function(j){$(this).find(".InputfieldRepeaterSort").slice(0,1).attr("value",j)});h.item.find("textarea.InputfieldCKEditorNormal:not(.InputfieldCKEditorLoaded)").each(function(){$(this).closest(".InputfieldCKEditor").trigger("reloaded",["InputfieldRepeaterSort"])});h.item.find(".InputfieldTinyMCE textarea").each(function(){tinyMCE.execCommand("mceAddControl",false,$(this).attr("id"))})}});var a=$(".InputfieldRepeaterAddLink:not(.InputfieldRepeaterAddLinkInit)",g);a.addClass("InputfieldRepeaterAddLinkInit");a.click(function(){var i=$(this);var o=$(this).parent("p").prev("ul.Inputfields");var j=$(this).parent().children("input");var n=0;function q(t){var u=t.attr("id")+"_";while($("#"+u).size()>0){u+="_"}t.attr("id",u);o.append(t);t.css("display","block");InputfieldRepeaterAdjustLabel(t,true);i.trigger("repeateradd",[t])}var s=i.attr("data-noajax").length==0;if(!s){var k=o.children(".InputfieldRepeaterNewItem");n=k.length;if(n>0){if(n>1){k=k.slice(0,1)}var m=k.clone(true);q(m);j.attr("value",n)}}else{var p=i.closest(".InputfieldRepeater").attr("data-page");var r=i.closest(".InputfieldRepeater").attr("id").replace("wrap_Inputfield_","");var h=ProcessWire.config.urls.admin+"page/edit/?id="+p+"&field="+r+"&repeater_add="+i.attr("data-type")+"&repeater_not=";var l=i.parent().find(".InputfieldRepeaterSpinner");l.removeClass(l.attr("data-off")).addClass(l.attr("data-on"));o.find(".InputfieldRepeaterUnpublished").each(function(){h+=$(this).attr("data-page")+","});$.get(h,function(u){l.removeClass(l.attr("data-on")).addClass(l.attr("data-off"));var t=$(u).find(".InputfieldRepeaterItem.InputfieldRepeaterUnpublished");if(!t.length){return}q(t);t.wrap("<div />");InputfieldsInit(t.parent());InputfieldRepeaterInit(t);t.unwrap();t.find(".Inputfield").trigger("reloaded",["InputfieldRepeaterItemAdd"]);t.find(".InputfieldRepeaterSort").val(o.children().length);$("html, body").animate({scrollTop:t.offset().top},500)})}return false})}$(document).ready(function(){$(".InputfieldRepeater").each(function(){InputfieldRepeaterInit($(this))});$(document).on("reloaded",".InputfieldRepeater",function(a,b){if(typeof b!="undefined"){if(b=="InputfieldRepeaterItemEdit"||b=="InputfieldRepeaterItemAdd"){a.stopPropagation();return}}InputfieldRepeaterInit($(this))});$(document).on("click",".InputfieldRepeaterTrash",InputfieldRepeaterDeleteClick);$(document).on("click",".InputfieldRepeaterToggle",InputfieldRepeaterToggleClick);$(document).on("opened",".InputfieldRepeaterItem",InputfieldRepeaterItemOpened);$(document).on("openReady",".InputfieldRepeaterItem",InputfieldRepeaterItemOpenReady)});