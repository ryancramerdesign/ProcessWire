function InputfieldRepeaterDeleteClick(d){var c=$(this).parent("label").parent("li");if(c.is(".InputfieldRepeaterNewItem")){var a=c.parent().parent().find(".InputfieldRepeaterAddItem").children("input");a.attr("value",parseInt(a.attr("value")-1));c.remove()}else{var b=c.find(".InputfieldRepeaterDelete");if(b.is(":checked")){b.removeAttr("checked");c.children("label").removeClass("ui-state-error").addClass("ui-state-default");c.removeClass("InputfieldRepeaterDeletePending")}else{b.attr("checked","checked");c.children("label").removeClass("ui-state-default").addClass("ui-state-error");if(!c.hasClass("InputfieldStateCollapsed")){c.toggleClass("InputfieldStateCollapsed",100)}c.addClass("InputfieldRepeaterDeletePending")}}d.stopPropagation()}function InputfieldRepeaterToggleClick(f){var d=$(this);var c=d.attr("data-on");var a=d.attr("data-off");var b=d.closest(".InputfieldRepeaterItem");var g=b.find(".InputfieldRepeaterPublish");if(d.hasClass(c)){d.removeClass(c).addClass(a);b.addClass("InputfieldRepeaterUnpublished InputfieldRepeaterOff");g.val("-1")}else{d.removeClass(a).addClass(c);b.removeClass("InputfieldRepeaterUnpublished InputfieldRepeaterOff");g.val("1")}f.stopPropagation()}function InputfieldRepeaterItemOpenReady(c){var a=$(this);var b=a.find(".InputfieldRepeaterLoaded");if(parseInt(b.val())>0){return}a.addClass("InputfieldRepeaterItemLoading")}function InputfieldRepeaterItemOpened(h){var j=$(this);var m=j.find(".InputfieldRepeaterLoaded");if(parseInt(m.val())>0){return}m.val("1");var b=j.find(".InputfieldContent").hide();var d=j.closest(".InputfieldRepeater");var i=d.attr("data-page");var c=parseInt(j.attr("data-page"));var l=d.attr("id");var k=l.replace("wrap_Inputfield_","");var a=ProcessWire.config.urls.admin+"page/edit/?id="+i+"&field="+k+"&repeater_edit="+c;var f=j.find(".InputfieldRepeaterDrag");var g=m.closest(".Inputfields");f.removeClass("fa-arrows").addClass("fa-spin fa-spinner");l=l.replace(/_repeater\d+$/,"");$.get(a,function(o){var e=$(o).find("#"+l+" > .InputfieldContent > .Inputfields > .InputfieldRepeaterItem > .InputfieldContent > .Inputfields > .InputfieldWrapper > .Inputfields > .Inputfield");g.append(e);j.removeClass("InputfieldRepeaterItemLoading");InputfieldsInit(g);var n=e.filter(".InputfieldRepeater");if(n.length){n.each(function(){InputfieldRepeaterInit($(this))})}b.slideDown("fast",function(){f.removeClass("fa-spin fa-spinner").addClass("fa-arrows")});g.find(".Inputfield").trigger("reloaded",["InputfieldRepeaterItemEdit"])})}function InputfieldRepeaterAdjustLabel(c,d){var b=c.children("label");var e=b.html();var a=e;if(d&&e.indexOf("#")>-1){num=c.siblings(".InputfieldRepeaterItem:visible").length+1;e=e.replace(/#[0-9]+/,"#"+num)}if(e.indexOf("{")>-1){e=e.replace(/\{/,'<span class="ui-priority-secondary" style="font-weight:normal">');e=e.replace(/}/,"</span>")}if(e!=a){b.html(e)}}function InputfieldRepeaterInit(f){if(f.hasClass("InputfieldRepeaterItem")){var c=f;var e=true}else{var c=f.find(".Inputfields:eq(0)");var e=false}if(c.hasClass("InputfieldRepeaterInit")){return}c.addClass("InputfieldRepeaterInit");var a=$("<i class='fa fa-trash InputfieldRepeaterTrash'></i>").css("display","block");var b=$("<i class='fa InputfieldRepeaterToggle' data-on='fa-toggle-on' data-off='fa-toggle-off'></i>");$("input.InputfieldRepeaterDelete",f).parents(".InputfieldCheckbox").hide();function d(g){g.each(function(){var j=$(this);var i="fa-arrows";var h=j.parent();if(h.hasClass("InputfieldRepeaterNewItem")){i="fa-plus";j.addClass("ui-priority-secondary")}j.addClass("ui-state-default");j.prepend("<i class='fa fa-fw "+i+" InputfieldRepeaterDrag'></i>");j.prepend(b.clone(true).addClass(j.parent().hasClass("InputfieldRepeaterOff")?"fa-toggle-off":"fa-toggle-on"));j.prepend(a.clone(true));InputfieldRepeaterAdjustLabel(h,false)})}if(e){d(f.children(".InputfieldHeader"))}else{d($(".InputfieldRepeaterItem > .InputfieldHeader",f))}$(".InputfieldRepeaterDrag",f).hover(function(){$(this).parent("label").addClass("ui-state-focus")},function(){$(this).parent("label").removeClass("ui-state-focus")});$(".InputfieldRepeaterTrash",f).hover(function(){var g=$(this).parent("label");if(!g.parent().is(".InputfieldRepeaterDeletePending")){g.addClass("ui-state-error")}},function(){var g=$(this).parent("label");if(!g.parent().is(".InputfieldRepeaterDeletePending")){g.removeClass("ui-state-error")}});if(e){c=f.closest(".InputfieldRepeater").find(".Inputfields:eq(0)")}c.sortable({items:"> li:not(.InputfieldRepeaterNewItem)",axis:"y",handle:".InputfieldRepeaterDrag",start:function(h,g){g.item.find(".InputfieldHeader").addClass("ui-state-highlight");g.item.find("textarea.InputfieldCKEditorNormal.InputfieldCKEditorLoaded").each(function(){$(this).removeClass("InputfieldCKEditorLoaded");var i=CKEDITOR.instances[$(this).attr("id")];i.destroy();CKEDITOR.remove($(this).attr("id"))});g.item.find(".InputfieldTinyMCE textarea").each(function(){tinyMCE.execCommand("mceRemoveControl",false,$(this).attr("id"))})},stop:function(h,g){g.item.find(".InputfieldHeader").removeClass("ui-state-highlight");$(this).children().each(function(i){$(this).find(".InputfieldRepeaterSort").slice(0,1).attr("value",i)});g.item.find("textarea.InputfieldCKEditorNormal:not(.InputfieldCKEditorLoaded)").each(function(){$(this).closest(".InputfieldCKEditor").trigger("reloaded",["InputfieldRepeaterSort"])});g.item.find(".InputfieldTinyMCE textarea").each(function(){tinyMCE.execCommand("mceAddControl",false,$(this).attr("id"))})}});$(".InputfieldRepeaterAddLink",f).click(function(){var h=$(this);var n=$(this).parent("p").prev("ul.Inputfields");var i=$(this).parent().children("input");var m=0;function p(s){var t=s.attr("id")+"_";while($("#"+t).size()>0){t+="_"}s.attr("id",t);n.append(s);s.css("display","block");InputfieldRepeaterAdjustLabel(s,true);h.trigger("repeateradd",[s])}var r=h.attr("data-noajax").length==0;if(!r){var j=n.children(".InputfieldRepeaterNewItem");m=j.length;if(m>0){if(m>1){j=j.slice(0,1)}var l=j.clone(true);p(l);i.attr("value",m)}}else{var o=h.closest(".InputfieldRepeater").attr("data-page");var q=h.closest(".InputfieldRepeater").attr("id").replace("wrap_Inputfield_","");var g=ProcessWire.config.urls.admin+"page/edit/?id="+o+"&field="+q+"&repeater_add="+h.attr("data-type")+"&repeater_not=";var k=h.parent().find(".InputfieldRepeaterSpinner");k.removeClass(k.attr("data-off")).addClass(k.attr("data-on"));n.find(".InputfieldRepeaterUnpublished").each(function(){g+=$(this).attr("data-page")+","});$.get(g,function(t){k.removeClass(k.attr("data-on")).addClass(k.attr("data-off"));var s=$(t).find(".InputfieldRepeaterItem.InputfieldRepeaterUnpublished");if(!s.length){return}p(s);s.wrap("<div />");InputfieldsInit(s.parent());InputfieldRepeaterInit(s);s.unwrap();s.find(".Inputfield").trigger("reloaded",["InputfieldRepeaterItemAdd"]);s.find(".InputfieldRepeaterSort").val(n.children().length);$("html, body").animate({scrollTop:s.offset().top},500)})}return false})}$(document).ready(function(){$(".InputfieldRepeater").each(function(){InputfieldRepeaterInit($(this))});$(document).on("reloaded",".InputfieldRepeater",function(a,b){if(typeof b!="undefined"){if(b=="InputfieldRepeaterItemEdit"||b=="InputfieldRepeaterItemAdd"){a.stopPropagation();return}}InputfieldRepeaterInit($(this))});$(document).on("click",".InputfieldRepeaterTrash",InputfieldRepeaterDeleteClick);$(document).on("click",".InputfieldRepeaterToggle",InputfieldRepeaterToggleClick);$(document).on("opened",".InputfieldRepeaterItem",InputfieldRepeaterItemOpened);$(document).on("openReady",".InputfieldRepeaterItem",InputfieldRepeaterItemOpenReady)});