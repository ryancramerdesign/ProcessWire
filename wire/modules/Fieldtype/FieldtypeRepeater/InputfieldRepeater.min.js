function InputfieldRepeaterDeleteClick(d){var c=$(this).parent("label").parent("li");if(c.is(".InputfieldRepeaterNewItem")){var a=c.parent().parent().find(".InputfieldRepeaterAddItem").children("input");a.attr("value",parseInt(a.attr("value")-1));c.remove()}else{var b=c.find(".InputfieldRepeaterDelete");if(b.is(":checked")){b.removeAttr("checked");c.children("label").removeClass("ui-state-error").addClass("ui-state-default");c.removeClass("InputfieldRepeaterDeletePending")}else{b.attr("checked","checked");c.children("label").removeClass("ui-state-default").addClass("ui-state-error");if(!c.hasClass("InputfieldStateCollapsed")){c.toggleClass("InputfieldStateCollapsed",100)}c.addClass("InputfieldRepeaterDeletePending")}}d.stopPropagation()}function InputfieldRepeaterToggleClick(f){var d=$(this);var c=d.attr("data-on");var a=d.attr("data-off");var b=d.closest(".InputfieldRepeaterItem");var g=b.find(".InputfieldRepeaterPublish");if(d.hasClass(c)){d.removeClass(c).addClass(a);b.addClass("InputfieldRepeaterUnpublished InputfieldRepeaterOff");g.val("-1")}else{d.removeClass(a).addClass(c);b.removeClass("InputfieldRepeaterUnpublished InputfieldRepeaterOff");g.val("1")}f.stopPropagation()}function InputfieldRepeaterItemOpenReady(c){var a=$(this);var b=a.find(".InputfieldRepeaterLoaded");if(parseInt(b.val())>0){return}a.addClass("InputfieldRepeaterItemLoading")}function InputfieldRepeaterUpdateState(a){if(!a.closest(".InputfieldRepeaterRememberOpen").length){return}var b="";$(".InputfieldRepeaterItem:not(.InputfieldStateCollapsed)").each(function(){var c=parseInt($(this).attr("data-page"));if(c>0){b+=c+"|"}});$.cookie("repeaters_open",b)}function InputfieldRepeaterItemClosed(a){InputfieldRepeaterUpdateState($(this))}function InputfieldRepeaterItemOpened(h){var j=$(this);var m=j.find(".InputfieldRepeaterLoaded");InputfieldRepeaterUpdateState(j);if(parseInt(m.val())>0){return}m.val("1");var b=j.find(".InputfieldContent").hide();var d=j.closest(".InputfieldRepeater");var i=d.attr("data-page");var c=parseInt(j.attr("data-page"));var l=d.attr("id");var k=l.replace("wrap_Inputfield_","");var a=ProcessWire.config.InputfieldRepeater.editorUrl+"?id="+i+"&field="+k+"&repeater_edit="+c;var f=j.find(".InputfieldRepeaterDrag");var g=m.closest(".Inputfields");f.removeClass("fa-arrows").addClass("fa-spin fa-spinner");l=l.replace(/_repeater\d+$/,"");$.get(a,function(o){var e=$(o).find("#"+l+" > .InputfieldContent > .Inputfields > .InputfieldRepeaterItem > .InputfieldContent > .Inputfields > .InputfieldWrapper > .Inputfields > .Inputfield");g.append(e);j.removeClass("InputfieldRepeaterItemLoading");InputfieldsInit(g);var n=e.filter(".InputfieldRepeater");if(n.length){n.each(function(){InputfieldRepeaterInit($(this))})}b.slideDown("fast",function(){f.removeClass("fa-spin fa-spinner").addClass("fa-arrows")});setTimeout(function(){g.find(".Inputfield").trigger("reloaded",["InputfieldRepeaterItemEdit"])},50)})}function InputfieldRepeaterAdjustLabel(c,d){var b=c.children("label");var e=b.html();var a=e;if(d&&e.indexOf("#")>-1){num=c.siblings(".InputfieldRepeaterItem:visible").length+1;e=e.replace(/#[0-9]+/,"#"+num)}if(e.indexOf("{")>-1){e=e.replace(/\{/,'<span class="ui-priority-secondary" style="font-weight:normal">');e=e.replace(/}/,"</span>")}if(e!=a){b.html(e)}}function InputfieldRepeaterInit(h){if(h.hasClass("InputfieldRepeaterItem")){var e=h;var g=true}else{var e=h.find(".Inputfields:eq(0)");var g=false}if(e.hasClass("InputfieldRepeaterInit")){return}e.addClass("InputfieldRepeaterInit");var c=$("<i class='fa fa-trash InputfieldRepeaterTrash'></i>").css("display","block");var d=$("<i class='fa InputfieldRepeaterToggle' data-on='fa-toggle-on' data-off='fa-toggle-off'></i>");var b=ProcessWire.config.InputfieldRepeater;if(b){d.attr("title",b.labels.toggle);c.attr("title",b.labels.remove)}$("input.InputfieldRepeaterDelete",h).parents(".InputfieldCheckbox").hide();function f(i){i.each(function(){var l=$(this);if(l.hasClass("InputfieldRepeaterHeaderInit")){return}var k="fa-arrows";var j=l.parent();if(j.hasClass("InputfieldRepeaterNewItem")){k="fa-plus";l.addClass("ui-priority-secondary")}l.addClass("ui-state-default InputfieldRepeaterHeaderInit");l.prepend("<i class='fa fa-fw "+k+" InputfieldRepeaterDrag'></i>");l.prepend(d.clone(true).addClass(l.parent().hasClass("InputfieldRepeaterOff")?"fa-toggle-off":"fa-toggle-on"));l.prepend(c.clone(true));InputfieldRepeaterAdjustLabel(j,false)})}if(g){f(h.children(".InputfieldHeader"))}else{f($(".InputfieldRepeaterItem > .InputfieldHeader",h))}$(".InputfieldRepeaterDrag",h).hover(function(){$(this).parent("label").addClass("ui-state-focus")},function(){$(this).parent("label").removeClass("ui-state-focus")});$(".InputfieldRepeaterTrash",h).hover(function(){var i=$(this).parent("label");if(!i.parent().is(".InputfieldRepeaterDeletePending")){i.addClass("ui-state-error")}},function(){var i=$(this).parent("label");if(!i.parent().is(".InputfieldRepeaterDeletePending")){i.removeClass("ui-state-error")}});if(g){e=h.closest(".InputfieldRepeater").find(".Inputfields:eq(0)")}e.sortable({items:"> li:not(.InputfieldRepeaterNewItem)",axis:"y",handle:".InputfieldRepeaterDrag",start:function(j,i){i.item.find(".InputfieldHeader").addClass("ui-state-highlight");i.item.find("textarea.InputfieldCKEditorNormal.InputfieldCKEditorLoaded").each(function(){$(this).removeClass("InputfieldCKEditorLoaded");var k=CKEDITOR.instances[$(this).attr("id")];k.destroy();CKEDITOR.remove($(this).attr("id"))});i.item.find(".InputfieldTinyMCE textarea").each(function(){tinyMCE.execCommand("mceRemoveControl",false,$(this).attr("id"))})},stop:function(j,i){i.item.find(".InputfieldHeader").removeClass("ui-state-highlight");$(this).children().each(function(k){$(this).find(".InputfieldRepeaterSort").slice(0,1).attr("value",k)});i.item.find("textarea.InputfieldCKEditorNormal:not(.InputfieldCKEditorLoaded)").each(function(){$(this).closest(".InputfieldCKEditor").trigger("reloaded",["InputfieldRepeaterSort"])});i.item.find(".InputfieldTinyMCE textarea").each(function(){tinyMCE.execCommand("mceAddControl",false,$(this).attr("id"))})}});var a=$(".InputfieldRepeaterAddLink:not(.InputfieldRepeaterAddLinkInit)",h);a.addClass("InputfieldRepeaterAddLinkInit");a.click(function(){var j=$(this);var p=$(this).parent("p").prev("ul.Inputfields");var k=$(this).parent().children("input");var o=0;function r(u){var v=u.attr("id")+"_";while($("#"+v).size()>0){v+="_"}u.attr("id",v);p.append(u);u.css("display","block");InputfieldRepeaterAdjustLabel(u,true);j.trigger("repeateradd",[u])}var t=j.attr("data-noajax").length==0;if(!t){var l=p.children(".InputfieldRepeaterNewItem");o=l.length;if(o>0){if(o>1){l=l.slice(0,1)}var n=l.clone(true);r(n);k.attr("value",o)}}else{var q=j.closest(".InputfieldRepeater").attr("data-page");var s=j.closest(".InputfieldRepeater").attr("id").replace("wrap_Inputfield_","");var i=ProcessWire.config.InputfieldRepeater.editorUrl+"?id="+q+"&field="+s+"&repeater_add="+j.attr("data-type")+"&repeater_not=";var m=j.parent().find(".InputfieldRepeaterSpinner");m.removeClass(m.attr("data-off")).addClass(m.attr("data-on"));p.find(".InputfieldRepeaterUnpublished").each(function(){i+=$(this).attr("data-page")+","});$.get(i,function(v){m.removeClass(m.attr("data-on")).addClass(m.attr("data-off"));var u=$(v).find(".InputfieldRepeaterItem.InputfieldRepeaterUnpublished");if(!u.length){return}r(u);u.wrap("<div />");InputfieldsInit(u.parent());InputfieldRepeaterInit(u);u.unwrap();u.find(".Inputfield").trigger("reloaded",["InputfieldRepeaterItemAdd"]);u.find(".InputfieldRepeaterSort").val(p.children().length);$("html, body").animate({scrollTop:u.offset().top},500);InputfieldRepeaterUpdateState(u)})}return false})}$(document).ready(function(){$(".InputfieldRepeater").each(function(){InputfieldRepeaterInit($(this))});$(document).on("reloaded",".InputfieldRepeater",function(b,c){if(typeof c!="undefined"){if(c=="InputfieldRepeaterItemEdit"||c=="InputfieldRepeaterItemAdd"){b.stopPropagation();var a=$(this).find(".InputfieldRepeater");if(a.length){InputfieldRepeaterInit(a)}return}}InputfieldRepeaterInit($(this))});$(document).on("click",".InputfieldRepeaterTrash",InputfieldRepeaterDeleteClick);$(document).on("click",".InputfieldRepeaterToggle",InputfieldRepeaterToggleClick);$(document).on("opened",".InputfieldRepeaterItem",InputfieldRepeaterItemOpened);$(document).on("closed",".InputfieldRepeaterItem",InputfieldRepeaterItemClosed);$(document).on("openReady",".InputfieldRepeaterItem",InputfieldRepeaterItemOpenReady)});