var pwModalWindows=[];function pwModalWindowSettings(b){var d=config.modals[b];if(typeof d=="undefined"){d=config.modals.medium}d=d.split(",");var a={modal:true,draggable:false,resizable:true,hide:250,show:100,hideOverflow:true,closeOnEscape:false};if(d.length>=4){for(var f=4;f<d.length;f++){var e=d[f];if(e.indexOf("=")<1){continue}e=e.split("=");var c=jQuery.trim(e[0]);e=jQuery.trim(e[1].toLowerCase());if(typeof a[c]=="undefined"){continue}if(e=="true"||e=="1"){e=true}else{if(e=="false"||e=="0"){e=false}else{e=parseInt(e)}}a[c]=e}}return{modal:a.modal,draggable:a.draggable,resizable:a.resizable,position:[parseInt(d[0]),parseInt(d[1])],width:$(window).width()-parseInt(d[2]),height:$(window).height()-parseInt(d[3]),hide:a.hide,show:a.show,closeOnEscape:a.closeOnEscape,create:function(g,h){if(a.hideOverflow){parent.jQuery("body").css("overflow","hidden")}var i=$(this).dialog("widget");$(".ui-dialog-titlebar-close",i).css("padding-top",0).prepend("<i class='fa fa-times'></i>").find(".ui-icon").remove()},beforeClose:function(g,h){if(a.hideOverflow){parent.jQuery("body").css("overflow","")}}}}function pwModalWindow(c,j,i){for(var e=0;e<=pwModalWindows.length;e++){var h=pwModalWindows[e];if(h==null){continue}if(h.dialog("isOpen")){continue}h.dialog("destroy").remove();pwModalWindows[e]=null}if(c.indexOf("modal=")>0){var b=c}else{var b=c+(c.indexOf("?")>-1?"&":"?")+"modal=1"}var h=$('<iframe class="pw-modal-window" frameborder="0" src="'+b+'"></iframe>');h.attr("id","pw-modal-window-"+(pwModalWindows.length+1));if(typeof i=="undefined"||i.length==0){var i="large"}var f=pwModalWindowSettings(i);if(f==null){alert("Unknown modal setting: "+i);return h}if(typeof j!="undefined"){$.extend(f,j)}h.on("dialogopen",function(k,l){$(document).trigger("pw-modal-opened",{event:k,ui:l})});h.on("dialogclose",function(k,l){$(document).trigger("pw-modal-closed",{event:k,ui:l})});h.dialog(f);h.data("settings",f);h.load(function(){if(typeof f.title=="undefined"||!f.title){h.dialog("option","title",h.contents().find("title").text())}h.contents().find("form").css("-webkit-backface-visibility","hidden")});var d=0;var g=0;function a(){var n=$(window).width();var l=$(window).height();if(n==d&&l==g){return}var m=i;if(n<=960&&i!="full"&&i!="large"){m="large"}if(n<=700&&i!="full"){m="full"}var o=pwModalWindowSettings(m);var p=h.closest(".ui-dialog");if(p.length>0){var k=p.find(".ui-dialog-buttonpane").outerHeight()+p.find(".ui-dialog-titlebar").outerHeight();o.height-=k}h.dialog("option","width",o.width);h.dialog("option","height",o.height);h.dialog("option","position",o.position);h.width(o.width).height(o.height);d=n;g=l}a();$(window).resize(a);h.refresh=function(){d=0;g=0;a()};h.setButtons=function(k){h.dialog("option","buttons",k);h.refresh()};h.setTitle=function(k){h.dialog("option","title",k)};return h}$(document).ready(function(){$.widget("ui.dialog",$.extend({},$.ui.dialog.prototype,{_title:function(a){if(!this.options.title){a.html("&#160;")}else{a.html(this.options.title)}}}));$(document).on("click","a.pw-modal, button.pw-modal",function(){var c=$(this);var a=c.attr("data-autoclose");var j=a!=null;var h=j&&a.length>1?a:"";var g=c.attr("data-close");var i=false;var d="medium";if(c.hasClass("pw-modal-large")){d="large"}else{if(c.hasClass("pw-modal-small")){d="small"}else{if(c.hasClass("pw-modal-full")){d="full"}}}var e={title:c.attr("title"),close:function(n,o){c.trigger("modal-close",{event:n,ui:o});c.trigger("pw-modal-closed",{event:n,ui:o});$(document).trigger("pw-modal-closed",{event:n,ui:o});f.remove()}};var m=c.attr("data-buttons");if(g==null){g=""}g+=(g.length>0?", ":"")+".pw-modal-cancel";var f=$("<i class='fa fa-spin fa-spinner fa-2x ui-priority-secondary'></i>").css({position:"absolute",top:(parseInt($(window).height()/2)-80)+"px",left:(parseInt($(window).width()/2)-20)+"px","z-index":9999}).hide();if(c.is("button")){var k=c.closest("a");var b=k.length?k.attr("href"):c.attr("data-href");if(!b){b=c.find("a").attr("href")}if(!b){alert("Unable to find href attribute for: "+c.text());return}}else{var b=c.attr("href")}var l=pwModalWindow(b,e,d);$("body").append(f.fadeIn("fast"));l.load(function(){var p=[];var r=l.contents();var s=0;f.fadeOut("fast",function(){f.remove()});if(i){if(r.find(".NoticeError, .NoticeWarning, .ui-state-error").length==0){if(typeof Notifications!="undefined"){var o=[];r.find(".NoticeMessage").each(function(){o[o.length]=$(this).text()});if(o.length>0){setTimeout(function(){for(var n=0;n<o.length;n++){Notifications.message(o[n])}},500)}}l.dialog("close");return}}var q=r.find("body");q.hide();if(m){r.find(m).each(function(){var u=$(this);u.find(".ui-button-text").removeClass("ui-button-text");var v=u.html();var t=false;for(var n=0;n<p.length;n++){if(p[n].text==v||v.length<1){t=true}}if(!t){p[s]={html:v,"class":(u.is(".ui-priority-secondary")?"ui-priority-secondary":""),click:function(w){$(w.currentTarget).fadeOut("fast");u.click();if(g.length>0&&u.is(g)){l.dialog("close")}if(j){$("body").append(f.fadeIn());if(h.length>1){i=u.is(h)}else{i=true}}}};s++}if(!u.hasClass("pw-modal-button-visible")){u.hide()}})}if(p.length>0){l.setButtons(p)}q.fadeIn("fast",function(){q.show()})});return false})});