(function(){function a(c,d,e){if(!d.is||!d.getCustomData("block_processed")){d.is&&CKEDITOR.dom.element.setMarker(e,d,"block_processed",!0),c.push(d)}}function b(e,f){function h(){this.foreach(function(j){if(/^(?!vbox|hbox)/.test(j.type)&&(j.setup||(j.setup=function(k){j.setValue(k.getAttribute(j.id)||"",1)}),!j.commit)){j.commit=function(l){var k=this.getValue();j.id=="dir"&&l.getComputedStyle("direction")==k||(k?l.setAttribute(j.id,k):l.removeAttribute(j.id))}}})}var i=function(){var j=CKEDITOR.tools.extend({},CKEDITOR.dtd.$blockLimit);e.config.div_wrapTable&&(delete j.td,delete j.th);return j}(),g=CKEDITOR.dtd.div,d={},c=[];return{title:e.lang.div.title,minWidth:400,minHeight:165,contents:[{id:"info",label:e.lang.common.generalTab,title:e.lang.common.generalTab,elements:[{type:"hbox",widths:["50%","50%"],children:[{id:"elementStyle",type:"select",style:"width: 100%;",label:e.lang.div.styleSelectLabel,"default":"",items:[[e.lang.common.notSet,""]],onChange:function(){var m=["info:elementStyle","info:class","advanced:dir","advanced:style"],o=this.getDialog(),l=o._element&&o._element.clone()||new CKEDITOR.dom.element("div",e.document);this.commit(l,!0);for(var m=[].concat(m),j=m.length,k,n=0;n<j;n++){(k=o.getContentElement.apply(o,m[n].split(":")))&&k.setup&&k.setup(l,!0)}},setup:function(j){for(var k in d){d[k].checkElementRemovable(j,!0,e)&&this.setValue(k,1)}},commit:function(j){var k;(k=this.getValue())?d[k].applyToObject(j,e):j.removeAttribute("style")}},{id:"class",type:"text",requiredContent:"div(cke-xyz)",label:e.lang.common.cssClass,"default":""}]}]},{id:"advanced",label:e.lang.common.advancedTab,title:e.lang.common.advancedTab,elements:[{type:"vbox",padding:1,children:[{type:"hbox",widths:["50%","50%"],children:[{type:"text",id:"id",requiredContent:"div[id]",label:e.lang.common.id,"default":""},{type:"text",id:"lang",requiredContent:"div[lang]",label:e.lang.common.langCode,"default":""}]},{type:"hbox",children:[{type:"text",id:"style",requiredContent:"div{cke-xyz}",style:"width: 100%;",label:e.lang.common.cssStyle,"default":"",commit:function(j){j.setAttribute("style",this.getValue())}}]},{type:"hbox",children:[{type:"text",id:"title",requiredContent:"div[title]",style:"width: 100%;",label:e.lang.common.advisoryTitle,"default":""}]},{type:"select",id:"dir",requiredContent:"div[dir]",style:"width: 100%;",label:e.lang.common.langDir,"default":"",items:[[e.lang.common.notSet,""],[e.lang.common.langDirLtr,"ltr"],[e.lang.common.langDirRtl,"rtl"]]}]}]}],onLoad:function(){h.call(this);var j=this,k=this.getContentElement("info","elementStyle");e.getStylesSet(function(n){var l,m;if(n){for(var o=0;o<n.length;o++){m=n[o],m.element&&"div"==m.element&&(l=m.name,d[l]=m=new CKEDITOR.style(m),e.filter.check(m)&&(k.items.push([l,l]),k.add(l,l)))}}k[1<k.items.length?"enable":"disable"]();setTimeout(function(){j._element&&k.setup(j._element)},0)})},onShow:function(){"editdiv"==f&&this.setupContent(this._element=CKEDITOR.plugins.div.getSurroundDiv(e))},onOk:function(){if("editdiv"==f){c=[this._element]}else{var q=[],t={},p=[],u,n=e.getSelection(),r=n.getRanges(),k=n.createBookmarks(),o,m;for(o=0;o<r.length;o++){for(m=r[o].createIterator();u=m.getNextParagraph();){if(u.getName() in i&&!u.isReadOnly()){var s=u.getChildren();for(u=0;u<s.count();u++){a(p,s.getItem(u),t)}}else{for(;!g[u.getName()]&&!u.equals(r[o].root);){u=u.getParent()}a(p,u,t)}}}CKEDITOR.dom.element.clearAllMarkers(t);r=[];o=null;for(m=0;m<p.length;m++){u=p[m],s=e.elementPath(u).blockLimit,s.isReadOnly()&&(s=s.getParent()),e.config.div_wrapTable&&s.is(["td","th"])&&(s=e.elementPath(s.getParent()).blockLimit),s.equals(o)||(o=s,r.push([])),r[r.length-1].push(u)}for(o=0;o<r.length;o++){s=r[o][0];p=s.getParent();for(u=1;u<r[o].length;u++){p=p.getCommonAncestor(r[o][u])}m=new CKEDITOR.dom.element("div",e.document);for(u=0;u<r[o].length;u++){for(s=r[o][u];!s.getParent().equals(p);){s=s.getParent()}r[o][u]=s}for(u=0;u<r[o].length;u++){if(s=r[o][u],!s.getCustomData||!s.getCustomData("block_processed")){s.is&&CKEDITOR.dom.element.setMarker(t,s,"block_processed",!0),u||m.insertBefore(s),m.append(s)}}CKEDITOR.dom.element.clearAllMarkers(t);q.push(m)}n.selectBookmarks(k);c=q}q=c.length;for(t=0;t<q;t++){this.commitContent(c[t]),!c[t].getAttribute("style")&&c[t].removeAttribute("style")}this.hide()},onHide:function(){"editdiv"==f&&this._element.removeCustomData("elementStyle");delete this._element}}}CKEDITOR.dialog.add("creatediv",function(c){return b(c,"creatediv")});CKEDITOR.dialog.add("editdiv",function(c){return b(c,"editdiv")})})();