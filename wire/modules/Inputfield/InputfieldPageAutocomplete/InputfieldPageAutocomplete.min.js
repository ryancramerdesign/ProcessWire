var InputfieldPageAutocomplete={init:function(d,c,g,q,e){var h=$("#"+d+"_items");var n=$("#"+d+"_input");var j=n.parent().find(".InputfieldPageAutocompleteStatus");var i=n.parent().find(".InputfieldPageAutocompleteNote");var o=0;var b=0;var l=n.attr("data-disablechars");var m=j.height();if(m){var p=j.parent().height();var k=((p-m)/2);j.css("top",k+"px");j.css("left",(k/2)+"px")}else{}j.click(function(){n.focus()});j.attr("data-class",j.attr("class"));function f(){return $("#_"+h.attr("data-name")+"_add_items").size()>0}n.autocomplete({minLength:2,source:function(u,r){if(l&&l.length){var s=false;var t=u.term;for(var w=0;w<l.length;w++){if(t.indexOf(l[w])>-1){s=true;break}}if(s){r([]);return}}j.attr("class","fa fa-fw fa-spin fa-spinner");var t=u.term;if(n.hasClass("and_words")&&t.indexOf(" ")>0){t=t.replace(/\s+/,",")}var v=c+"&"+q+e+t;$.getJSON(v,function(x){j.attr("class",j.attr("data-class"));b=x.total;if(x.total>0){j.attr("class","fa fa-fw fa-angle-double-down")}else{if(f()){j.attr("class","fa fa-fw fa-plus-circle");i.show()}else{j.attr("class","fa fa-fw fa-frown-o")}}r($.map(x.matches,function(y){return{label:y[g],value:y[g],page_id:y.id}}))})},select:function(r,s){if(!s.item){return}if($(this).hasClass("no_list")){$(this).val(s.item.label).change();$(this).blur();return false}else{InputfieldPageAutocomplete.pageSelected(h,s.item);$(this).val("").focus();return false}}}).blur(function(){if(!$(this).val().length){n.val("")}j.attr("class",j.attr("data-class"));i.hide()}).keyup(function(){j.attr("class",j.attr("data-class"))}).keydown(function(r){if(r.keyCode==13){r.preventDefault();if(f()){if($.trim(n.val()).length<1){n.blur();return false}o++;var s={page_id:(-1*o),label:n.val()};InputfieldPageAutocomplete.pageSelected(h,s);n.val("").blur().focus();i.hide()}else{$(this).blur()}return false}});var a=function(r){r.sortable({axis:"y",update:function(t,s){InputfieldPageAutocomplete.rebuildInput($(this))},start:function(t,s){s.item.addClass("ui-state-highlight")},stop:function(t,s){s.item.removeClass("ui-state-highlight")}});r.addClass("InputfieldPageAutocompleteSortable")};$("#"+h.attr("id")).on("mouseover",">li",function(){$(this).removeClass("ui-state-default").addClass("ui-state-hover");a(h)}).on("mouseout",">li",function(){$(this).removeClass("ui-state-hover").addClass("ui-state-default")})},pageSelected:function(a,d){var c=false;a.children("li").each(function(){var f=parseInt($(this).children(".itemValue").text());if(f==d.page_id){c=$(this)}});var b=$("#"+a.attr("data-id")+"_input");b.blur();if(c){c.effect("highlight");return}var e=a.children(".itemTemplate").clone();e.removeClass("itemTemplate");e.children(".itemValue").text(d.page_id);e.children(".itemLabel").text(d.label);a.append(e);InputfieldPageAutocomplete.rebuildInput(a)},rebuildInput:function(d){var b=d.attr("data-id");var a=d.attr("data-name");var f=$("#"+b);var h="";var c="";var g=parseInt(f.attr("data-max"));var i=d.children(":not(.itemTemplate)");if(g>0&&i.size()>g){while(i.size()>g){i=i.slice(1)}d.children(":not(.itemTemplate)").replaceWith(i)}i.each(function(){var j=parseInt($(this).children(".itemValue").text());if(j>0){h+=","+j}else{if(j<0){h+=","+j;c+=$(this).children(".itemLabel").text()+"\n"}}});f.val(h);var e=$("#_"+a+"_add_items");if(e.size()>0){e.val(c)}}};$(document).ready(function(){$(".InputfieldPageAutocomplete ol").on("click","a.itemRemove",function(){var c=$(this).parent();var a=c.parent();var b=c.children(".itemValue").text();c.remove();InputfieldPageAutocomplete.rebuildInput(a);return false})});