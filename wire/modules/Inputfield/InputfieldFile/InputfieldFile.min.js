$(document).ready(function(){$(document).on("change",".InputfieldFileDelete input",function(){a($(this))}).on("dblclick",".InputfieldFileDelete",function(){var i=$(this).find("input");var h=$(this).parents(".InputfieldFileList").find(".InputfieldFileDelete input");if(i.is(":checked")){h.removeAttr("checked").change()}else{h.attr("checked","checked").change()}return false});function a(j){var h=j.parents(".InputfieldFileInfo");var i=j.closest(".InputfieldFile").hasClass("InputfieldItemListCollapse");if(j.is(":checked")){h.addClass("ui-state-error");if(!i){h.siblings(".InputfieldFileData").slideUp("fast")}}else{h.removeClass("ui-state-error");if(!i){h.siblings(".InputfieldFileData").slideDown("fast")}}}function c(h){h.each(function(){var j=$(this);var k=j.children("li").length;if(j.closest(".InputfieldRenderValueMode").length){return}var i=j.closest(".Inputfield");if(k<2){if(k==0){i.addClass("InputfieldFileEmpty").removeClass("InputfieldFileMultiple InputfieldFileSingle")}else{i.addClass("InputfieldFileSingle").removeClass("InputfieldFileEmpty InputfieldFileMultiple")}return}else{j.closest(".Inputfield").removeClass("InputfieldFileSingle InputfieldFileEmpty").addClass("InputfieldFileMultiple")}j.sortable({start:function(m,l){l.item.children(".InputfieldFileInfo").addClass("ui-state-highlight")},stop:function(m,l){$(this).children("li").each(function(o){$(this).find(".InputfieldFileSort").val(o)});l.item.children(".InputfieldFileInfo").removeClass("ui-state-highlight");i.addClass("InputfieldFileJustSorted InputfieldStateChanged");setTimeout(function(){i.removeClass("InputfieldFileJustSorted")},500)}})}).find(".ui-widget-header, .ui-state-default").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")})}function d(){$("body").addClass("ie-no-drop");$(document).on("change",".InputfieldFileUpload input[type=file]",function(){var k=$(this);var p=k.parent(".InputMask");if(k.val().length>1){p.addClass("ui-state-disabled")}else{p.removeClass("ui-state-disabled")}if(p.next(".InputMask").length>0){return}var h=k.closest(".InputfieldFile");var m=k.closest(".InputfieldFileUpload");var l=h.find(".InputfieldFileList");var o=parseInt(m.find(".InputfieldFileMaxFiles").val());var j=l.children("li").length+m.find("input[type=file]").length+1;if(o>0&&j>=o){return}m.find(".InputMask").not(":last").each(function(){var r=$(this);if(r.find("input[type=file]").val()<1){r.remove()}});var q=p.clone().removeClass("ui-state-disabled");q.children("input[type=file]").val("");q.insertAfter(p);q.css("margin-left","0.5em").removeClass("ui-state-active");var i=k.val();var n=i.lastIndexOf("/");if(n===-1){n=i.lastIndexOf("\\")}i=i.substring(n+1);p.find(".ui-button-text").text(i).prepend("<i class='fa fa-fw fa-file-o'></i>");p.removeClass("ui-state-active")})}function e(i){if(i.length>0){var h=i.find(".InputfieldFileUpload")}else{var h=$(".InputfieldFileUpload")}h.closest(".InputfieldContent").each(function(k){if($(this).hasClass("InputfieldFileInit")){return}j($(this),k);$(this).addClass("InputfieldFileInit")});function j(q,y){var p=q.parents("form");var m=p.attr("action");m+=(m.indexOf("?")>-1?"&":"?")+"InputfieldFileAjax=1";var C=p.find("input._post_token");var o=C.attr("name");var t=C.val();var A=q.find(".InputfieldFileUpload");var l=A.data("fieldname");l=l.slice(0,-2);var B=A.data("extensions").toLowerCase();var x=A.data("maxfilesize");var s=q.find("input[type=file]").get(0);var r=q.get(0);var k=q.find(".InputfieldFileList");if(k.size()<1){k=$("<ul class='InputfieldFileList InputfieldFileListBlank'></ul>");q.prepend(k);q.parent(".Inputfield").addClass("InputfieldFileEmpty")}var z=k.get(0);var u=parseInt(q.find(".InputfieldFileMaxFiles").val());k.children().addClass("InputfieldFileItemExisting");q.find(".AjaxUploadDropHere").show();var v=null;function n(F){var I=$('<li class="InputfieldFile ui-widget AjaxUpload"><p class="InputfieldFileInfo ui-widget ui-widget-header InputfieldItemHeader"></p></li>'),H=$('<div class="ui-progressbar ui-widget ui-widget-content ui-corner-all" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div>'),G=$('<div class="ui-progressbar-value ui-widget-header InputfieldItemHeader ui-corner-left" style="width: 0%; "></div>'),J,K,M,L;H.append(G);I.append(H);M=new XMLHttpRequest();M.upload.addEventListener("progress",function(N){if(N.lengthComputable){var O=(N.loaded/N.total)*100;G.width(O+"%");if(O>4){G.html("<span>"+parseInt(O)+"%</span>")}}else{}},false);M.addEventListener("load",function(){var T=$.parseJSON(M.responseText);if(T.error!==undefined){T=[T]}for(var R=0;R<T.length;R++){var O=T[R];if(O.error){var S=I.clone();S.find(".InputfieldFileInfo").addClass("ui-state-error");S.find(".InputfieldFileStats").text(" - "+O.message);S.find(".ui-progressbar").remove();I.after(S)}else{if(O.replace){var Q=q.find(".InputfieldFileList").children("li:eq(0)");if(Q.size()>0){Q.slideUp("fast",function(){Q.remove()})}}var Y=q.find("input[type=file]");if(Y.val()){Y.replaceWith(Y.clone(true))}var V=$(O.markup);V.hide();if(O.overwrite){var X=V.find(".InputfieldFileName").text();var Z=null;k.children(".InputfieldFileItemExisting").each(function(){if(Z===null&&$(this).find(".InputfieldFileName").text()==X){Z=$(this)}});if(Z!==null){var U=V.find(".InputfieldFileInfo");var N=V.find(".InputfieldFileLink");var P=Z.find(".InputfieldFileInfo");var W=Z.find(".InputfieldFileLink");P.html(U.html()+"<i class='fa fa-check'></i>");W.html(N.html());Z.addClass("InputfieldFileItemExisting");Z.effect("highlight",500)}else{k.append(V);V.slideDown();V.addClass("InputfieldFileItemExisting")}}else{k.append(V);V.slideDown()}}}I.remove();if(v){clearTimeout(v)}v=setTimeout(function(){if(u!=1&&!k.is(".ui-sortable")){c(k)}k.trigger("AjaxUploadDone")},500)},false);M.open("POST",m,true);M.setRequestHeader("X-FILENAME",encodeURIComponent(F.name));M.setRequestHeader("X-FIELDNAME",l);M.setRequestHeader("Content-Type","application/octet-stream");M.setRequestHeader("X-"+o,t);M.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest");M.send(F);L="<i class='fa fa-fw fa-spin fa-spinner'></i> <span class=\"InputfieldFileName\">"+F.name+'</span><span class="InputfieldFileStats"> &bull; '+parseInt(F.size/1024,10)+" kb</span>";I.find("p.ui-widget-header").html(L);k.append(I);var D=k.closest(".Inputfield");D.addClass("InputfieldStateChanged");var E=D.find(".InputfieldFileItem").length;if(E==1){D.removeClass("InputfieldFileEmpty").removeClass("InputfieldFileMultiple").addClass("InputfieldFileSingle")}else{if(E>1){D.removeClass("InputfieldFileEmpty").removeClass("InputfieldFileSingle").addClass("InputfieldFileMultiple")}}}function w(F){function G(I,J){return'<li class="InputfieldFile ui-widget AjaxUpload"><p class="InputfieldFileInfo ui-widget ui-widget-header InputfieldItemHeader ui-state-error">&nbsp; '+I+' <span class="InputfieldFileStats"> &bull; '+J+"</span></p></li>"}if(typeof F!=="undefined"){for(var E=0,D=F.length;E<D;E++){var H=F[E].name.split(".").pop().toLowerCase();if(B.indexOf(H)==-1){k.append(G(F[E].name,H+" is a invalid file extension, please use one of:  "+B))}else{if(F[E].size>x&&x>2000000){k.append(G(F[E].name,"Filesize "+parseInt(F[E].size/1024,10)+" kb is too big. Maximum allowed is "+parseInt(x/1024,10)+" kb"))}else{n(F[E])}}if(u==1){break}}}else{z.innerHTML="No support for the File API in this web browser"}}s.addEventListener("change",function(D){w(this.files);D.preventDefault();D.stopPropagation();this.value=""},false);r.addEventListener("dragleave",function(){$(this).removeClass("ui-state-hover")},false);r.addEventListener("dragenter",function(){$(this).addClass("ui-state-hover")},false);r.addEventListener("dragover",function(D){if(!$(this).is("ui-state-hover")){$(this).addClass("ui-state-hover")}D.preventDefault();D.stopPropagation()},false);r.addEventListener("drop",function(D){w(D.dataTransfer.files);$(this).removeClass("ui-state-hover");D.preventDefault();D.stopPropagation()},false)}}c($(".InputfieldFileList"));if(window.File&&window.FileList&&window.FileReader&&($("#PageIDIndicator").length>0||$(".InputfieldAllowAjaxUpload").length>0)){e("")}else{d()}var g=767;var f=false;var b=function(){$(".AjaxUploadDropHere").each(function(){var h=$(this);if(h.parent().width()<=g){h.hide()}else{h.show()}});f=false};$(window).resize(function(){if(f){return}f=true;setTimeout(b,1000)}).resize();$(document).on("reloaded",".InputfieldHasFileList",function(h){c($(this).find(".InputfieldFileList"));e($(this));b()})});