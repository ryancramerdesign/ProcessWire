$(document).ready(function(){$(document).on("change",".InputfieldFileDelete input",function(){a($(this))}).on("dblclick",".InputfieldFileDelete",function(){var i=$(this).find("input");var h=$(this).parents(".InputfieldFileList").find(".InputfieldFileDelete input");if(i.is(":checked")){h.removeAttr("checked").change()}else{h.attr("checked","checked").change()}return false});function a(j){var h=j.parents(".InputfieldFileInfo");var i=j.closest(".InputfieldFile").hasClass("InputfieldItemListCollapse");if(j.is(":checked")){h.addClass("ui-state-error");if(!i){h.siblings(".InputfieldFileData").slideUp("fast")}}else{h.removeClass("ui-state-error");if(!i){h.siblings(".InputfieldFileData").slideDown("fast")}}}function c(h){h.each(function(){var j=$(this);var k=j.children("li").length;if(j.closest(".InputfieldRenderValueMode").length){return}var i=j.closest(".Inputfield");if(k<2){if(k==0){i.addClass("InputfieldFileEmpty").removeClass("InputfieldFileMultiple InputfieldFileSingle")}else{i.addClass("InputfieldFileSingle").removeClass("InputfieldFileEmpty InputfieldFileMultiple")}return}else{j.closest(".Inputfield").removeClass("InputfieldFileSingle InputfieldFileEmpty").addClass("InputfieldFileMultiple")}j.sortable({start:function(m,l){l.item.children(".InputfieldFileInfo").addClass("ui-state-highlight")},stop:function(m,l){$(this).children("li").each(function(o){$(this).find(".InputfieldFileSort").val(o)});l.item.children(".InputfieldFileInfo").removeClass("ui-state-highlight");i.addClass("InputfieldFileJustSorted InputfieldStateChanged");setTimeout(function(){i.removeClass("InputfieldFileJustSorted")},500)}})}).find(".ui-widget-header, .ui-state-default").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")})}function d(){$(document).on("change",".InputfieldFileUpload input[type=file]",function(){var l=$(this);if(l.next("input.InputfieldFile").size()>0){return}var h=parseInt(l.siblings(".InputfieldFileMaxFiles").val());var i=l.parent(".InputfieldFileUpload").siblings(".InputfieldFileList").children("li").size()+l.siblings("input[type=file]").size()+1;if(h>0&&i>=h){return}var j=0;l.siblings("input[type=file]").each(function(){if($(this).val().length<1){j++}});if(j>0){return}var k=l.clone().hide().val("");l.after(k);k.slideDown()})}function e(i){if(i.length>0){var h=i.find(".InputfieldFileUpload")}else{var h=$(".InputfieldFileUpload")}h.closest(".ui-widget-content, .InputfieldContent").each(function(k){if($(this).hasClass("InputfieldFileInit")){return}j($(this),k);$(this).addClass("InputfieldFileInit")});function j(q,y){var p=q.parents("form");var m=p.attr("action");m+=(m.indexOf("?")>-1?"&":"?")+"InputfieldFileAjax=1";var B=p.find("input._post_token");var o=B.attr("name");var t=B.val();var l=q.find("p.InputfieldFileUpload").data("fieldname");l=l.slice(0,-2);var A=q.find("p.InputfieldFileUpload").data("extensions").toLowerCase();var x=q.find("p.InputfieldFileUpload").data("maxfilesize");var s=q.find("input[type=file]").get(0);var r=q.get(0);var k=q.find(".InputfieldFileList");if(k.size()<1){k=$("<ul class='InputfieldFileList InputfieldFileListBlank'></ul>");q.prepend(k);q.parent(".Inputfield").addClass("InputfieldFileEmpty")}var z=k.get(0);var u=parseInt(q.find(".InputfieldFileMaxFiles").val());k.children().addClass("InputfieldFileItemExisting");q.find(".AjaxUploadDropHere").show();var v=null;function n(E){var H=$('<li class="InputfieldFile ui-widget AjaxUpload"><p class="InputfieldFileInfo ui-widget ui-widget-header InputfieldItemHeader"></p></li>'),G=$('<div class="ui-progressbar ui-widget ui-widget-content ui-corner-all" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div>'),F=$('<div class="ui-progressbar-value ui-widget-header InputfieldItemHeader ui-corner-left" style="width: 0%; "></div>'),I,J,L,K;G.append(F);H.append(G);L=new XMLHttpRequest();L.upload.addEventListener("progress",function(M){if(M.lengthComputable){var N=(M.loaded/M.total)*100;F.width(N+"%");if(N>4){F.html("<span>"+parseInt(N)+"%</span>")}}else{}},false);L.addEventListener("load",function(){var S=$.parseJSON(L.responseText);if(S.error!==undefined){S=[S]}for(var Q=0;Q<S.length;Q++){var N=S[Q];if(N.error){var R=H.clone();R.find(".InputfieldFileInfo").addClass("ui-state-error");R.find(".InputfieldFileStats").text(" - "+N.message);R.find(".ui-progressbar").remove();H.after(R)}else{if(N.replace){var P=q.find(".InputfieldFileList").children("li:eq(0)");if(P.size()>0){P.slideUp("fast",function(){P.remove()})}}var X=q.find("input[type=file]");if(X.val()){X.replaceWith(X.clone(true))}var U=$(N.markup);U.hide();if(N.overwrite){var W=U.find(".InputfieldFileName").text();var Y=null;k.children(".InputfieldFileItemExisting").each(function(){if(Y===null&&$(this).find(".InputfieldFileName").text()==W){Y=$(this)}});if(Y!==null){var T=U.find(".InputfieldFileInfo");var M=U.find(".InputfieldFileLink");var O=Y.find(".InputfieldFileInfo");var V=Y.find(".InputfieldFileLink");O.html(T.html()+"<i class='fa fa-check'></i>");V.html(M.html());Y.addClass("InputfieldFileItemExisting");Y.effect("highlight",500)}else{k.append(U);U.slideDown();U.addClass("InputfieldFileItemExisting")}}else{k.append(U);U.slideDown()}}}H.remove();if(v){clearTimeout(v)}v=setTimeout(function(){if(u!=1&&!k.is(".ui-sortable")){c(k)}k.trigger("AjaxUploadDone")},500)},false);L.open("POST",m,true);L.setRequestHeader("X-FILENAME",encodeURIComponent(E.name));L.setRequestHeader("X-FIELDNAME",l);L.setRequestHeader("Content-Type","application/octet-stream");L.setRequestHeader("X-"+o,t);L.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest");L.send(E);K="<i class='fa fa-fw fa-spin fa-spinner'></i> <span class=\"InputfieldFileName\">"+E.name+'</span><span class="InputfieldFileStats"> &bull; '+parseInt(E.size/1024,10)+" kb</span>";H.find("p.ui-widget-header").html(K);k.append(H);var C=k.closest(".Inputfield");C.addClass("InputfieldStateChanged");var D=C.find(".InputfieldFileItem").length;if(D==1){C.removeClass("InputfieldFileEmpty").removeClass("InputfieldFileMultiple").addClass("InputfieldFileSingle")}else{if(D>1){C.removeClass("InputfieldFileEmpty").removeClass("InputfieldFileSingle").addClass("InputfieldFileMultiple")}}}function w(E){function F(H,I){return'<li class="InputfieldFile ui-widget AjaxUpload"><p class="InputfieldFileInfo ui-widget ui-widget-header InputfieldItemHeader ui-state-error">&nbsp; '+H+' <span class="InputfieldFileStats"> &bull; '+I+"</span></p></li>"}if(typeof E!=="undefined"){for(var D=0,C=E.length;D<C;D++){var G=E[D].name.split(".").pop().toLowerCase();if(A.indexOf(G)==-1){k.append(F(E[D].name,G+" is a invalid file extension, please use one of:  "+A))}else{if(E[D].size>x&&x>2000000){k.append(F(E[D].name,"Filesize "+parseInt(E[D].size/1024,10)+" kb is too big. Maximum allowed is "+parseInt(x/1024,10)+" kb"))}else{n(E[D])}}if(u==1){break}}}else{z.innerHTML="No support for the File API in this web browser"}}s.addEventListener("change",function(C){w(this.files);C.preventDefault();C.stopPropagation();this.value=""},false);r.addEventListener("dragleave",function(){$(this).removeClass("ui-state-hover")},false);r.addEventListener("dragenter",function(){$(this).addClass("ui-state-hover")},false);r.addEventListener("dragover",function(C){if(!$(this).is("ui-state-hover")){$(this).addClass("ui-state-hover")}C.preventDefault();C.stopPropagation()},false);r.addEventListener("drop",function(C){w(C.dataTransfer.files);$(this).removeClass("ui-state-hover");C.preventDefault();C.stopPropagation()},false)}}c($(".InputfieldFileList"));if(window.File&&window.FileList&&window.FileReader&&($("#PageIDIndicator").length>0||$(".InputfieldAllowAjaxUpload").length>0)){e("")}else{d()}var g=767;var f=false;var b=function(){$(".AjaxUploadDropHere").each(function(){var h=$(this);if(h.parent().width()<=g){h.hide()}else{h.show()}});f=false};$(window).resize(function(){if(f){return}f=true;setTimeout(b,1000)}).resize();$(document).on("reloaded",".InputfieldHasFileList",function(h){c($(this).find(".InputfieldFileList"));e($(this));b()})});