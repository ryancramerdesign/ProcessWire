$(document).ready(function(){$(document).on("change",".InputfieldFileDelete input",function(){a($(this))}).on("dblclick",".InputfieldFileDelete",function(){var i=$(this).find("input");var h=$(this).parents(".InputfieldFileList").find(".InputfieldFileDelete input");if(i.is(":checked")){h.removeAttr("checked").change()}else{h.attr("checked","checked").change()}return false});function a(h){if(h.is(":checked")){h.parents(".InputfieldFileInfo").addClass("ui-state-error").siblings(".InputfieldFileData").slideUp("fast")}else{h.parents(".InputfieldFileInfo").removeClass("ui-state-error").siblings(".InputfieldFileData").slideDown("fast")}}function c(h){h.each(function(){var j=$(this);var k=j.children("li").size();var i=j.closest(".Inputfield");if(k<2){if(k==0){i.addClass("InputfieldFileEmpty").removeClass("InputfieldFileMultiple InputfieldFileSingle")}else{i.addClass("InputfieldFileSingle").removeClass("InputfieldFileEmpty InputfieldFileMultiple")}return}else{j.closest(".Inputfield").removeClass("InputfieldFileSingle InputfieldFileEmpty").addClass("InputfieldFileMultiple")}j.sortable({start:function(m,l){l.item.children(".InputfieldFileInfo").addClass("ui-state-highlight")},stop:function(m,l){$(this).children("li").each(function(o){$(this).find(".InputfieldFileSort").val(o)});l.item.children(".InputfieldFileInfo").removeClass("ui-state-highlight");i.addClass("InputfieldFileJustSorted InputfieldStateChanged");setTimeout(function(){i.removeClass("InputfieldFileJustSorted")},500)}})}).find(".ui-widget-header, .ui-state-default").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")})}function d(){$(document).on("change",".InputfieldFileUpload input[type=file]",function(){var l=$(this);if(l.next("input.InputfieldFile").size()>0){return}var h=parseInt(l.siblings(".InputfieldFileMaxFiles").val());var i=l.parent(".InputfieldFileUpload").siblings(".InputfieldFileList").children("li").size()+l.siblings("input[type=file]").size()+1;if(h>0&&i>=h){return}var j=0;l.siblings("input[type=file]").each(function(){if($(this).val().length<1){j++}});if(j>0){return}var k=l.clone().hide().val("");l.after(k);k.slideDown()})}function e(i){if(i.length>0){var h=i.find(".InputfieldFileUpload")}else{var h=$(".InputfieldFileUpload")}h.closest(".ui-widget-content, .InputfieldContent").each(function(k){j($(this),k)});function j(q,y){var p=q.parents("form");var m=p.attr("action");var B=p.find("input._post_token");var o=B.attr("name");var t=B.val();var l=q.find("p.InputfieldFileUpload").data("fieldname");l=l.slice(0,-2);var A=q.find("p.InputfieldFileUpload").data("extensions").toLowerCase();var x=q.find("p.InputfieldFileUpload").data("maxfilesize");var s=q.find("input[type=file]").get(0);var r=q.get(0);var k=q.find(".InputfieldFileList");if(k.size()<1){k=$("<ul class='InputfieldFileList InputfieldFileListBlank'></ul>");q.prepend(k);q.parent(".Inputfield").addClass("InputfieldFileEmpty")}var z=k.get(0);var u=parseInt(q.find(".InputfieldFileMaxFiles").val());k.children().addClass("InputfieldFileItemExisting");q.find(".AjaxUploadDropHere").show();var v=null;function n(H){var D=$('<li class="InputfieldFile ui-widget AjaxUpload"><p class="InputfieldFileInfo ui-widget ui-widget-header InputfieldItemHeader"></p></li>'),F=$('<div class="ui-progressbar ui-widget ui-widget-content ui-corner-all" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div>'),I=$('<div class="ui-progressbar-value ui-widget-header InputfieldItemHeader ui-corner-left" style="width: 0%; "></div>'),E,C,J,G;F.append(I);D.append(F);J=new XMLHttpRequest();J.upload.addEventListener("progress",function(K){if(K.lengthComputable){var L=(K.loaded/K.total)*100;I.width(L+"%");if(L>4){I.html("<span>"+parseInt(L)+"%</span>")}}else{}},false);J.addEventListener("load",function(){var Q=$.parseJSON(J.responseText);if(Q.error!==undefined){Q=[Q]}for(var O=0;O<Q.length;O++){var L=Q[O];if(L.error){var P=D.clone();P.find(".InputfieldFileInfo").addClass("ui-state-error");P.find(".InputfieldFileStats").text(" - "+L.message);P.find(".ui-progressbar").remove();D.after(P)}else{if(L.replace){var N=q.find(".InputfieldFileList").children("li:eq(0)");if(N.size()>0){N.slideUp("fast",function(){N.remove()})}}var V=q.find("input[type=file]");if(V.val()){V.replaceWith(V.clone(true))}var S=$(L.markup);S.hide();if(L.overwrite){var U=S.find(".InputfieldFileName").text();var W=null;k.children(".InputfieldFileItemExisting").each(function(){if(W===null&&$(this).find(".InputfieldFileName").text()==U){W=$(this)}});if(W!==null){var R=S.find(".InputfieldFileInfo");var K=S.find(".InputfieldFileLink");var M=W.find(".InputfieldFileInfo");var T=W.find(".InputfieldFileLink");M.html(R.html()+"<i class='fa fa-check'></i>");T.html(K.html());W.addClass("InputfieldFileItemExisting");W.effect("highlight",500)}else{k.append(S);S.slideDown();S.addClass("InputfieldFileItemExisting")}}else{k.append(S);S.slideDown()}}}D.remove();if(v){clearTimeout(v)}v=setTimeout(function(){if(u!=1&&!k.is(".ui-sortable")){c(k)}k.trigger("AjaxUploadDone")},500)},false);J.open("POST",m,true);J.setRequestHeader("X-FILENAME",unescape(encodeURIComponent(H.name)));J.setRequestHeader("X-FIELDNAME",l);J.setRequestHeader("Content-Type","application/octet-stream");J.setRequestHeader("X-"+o,t);J.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest");J.send(H);G="<span class='ui-icon ui-icon-arrowreturnthick-1-e' style='margin-left: 2px;'></span><span class=\"InputfieldFileName\">"+H.name+'</span><span class="InputfieldFileStats"> &bull; '+parseInt(H.size/1024,10)+" kb</span>";D.find("p.ui-widget-header").html(G);k.append(D);k.closest(".Inputfield").addClass("InputfieldStateChanged")}function w(E){function F(H,I){return'<li class="InputfieldFile ui-widget AjaxUpload"><p class="InputfieldFileInfo ui-widget ui-widget-header InputfieldItemHeader ui-state-error">&nbsp; '+H+' <span class="InputfieldFileStats"> &bull; '+I+"</span></p></li>"}if(typeof E!=="undefined"){for(var D=0,C=E.length;D<C;D++){var G=E[D].name.split(".").pop().toLowerCase();if(A.indexOf(G)==-1){k.append(F(E[D].name,G+" is a invalid file extension, please use one of:  "+A))}else{if(E[D].size>x&&x>2000000){k.append(F(E[D].name,"Filesize "+parseInt(E[D].size/1024,10)+" kb is too big. Maximum allowed is "+parseInt(x/1024,10)+" kb"))}else{n(E[D])}}if(u==1){break}}}else{z.innerHTML="No support for the File API in this web browser"}}s.addEventListener("change",function(C){w(this.files);C.preventDefault();C.stopPropagation();this.value=""},false);r.addEventListener("dragleave",function(){$(this).removeClass("ui-state-hover")},false);r.addEventListener("dragenter",function(){$(this).addClass("ui-state-hover")},false);r.addEventListener("dragover",function(C){if(!$(this).is("ui-state-hover")){$(this).addClass("ui-state-hover")}C.preventDefault();C.stopPropagation()},false);r.addEventListener("drop",function(C){w(C.dataTransfer.files);$(this).removeClass("ui-state-hover");C.preventDefault();C.stopPropagation()},false)}}c($(".InputfieldFileList"));if(window.File&&window.FileList&&window.FileReader&&$("#PageIDIndicator").size()>0){e("")}else{d()}var g=767;var f=false;var b=function(){$(".AjaxUploadDropHere").each(function(){var h=$(this);if(h.parent().width()<=g){h.hide()}else{h.show()}});f=false};$(window).resize(function(){if(f){return}f=true;setTimeout(b,1000)}).resize();$(document).on("reloaded",".InputfieldFileMultiple, .InputfieldFileSingle",function(h){c($(this).find(".InputfieldFileList"));e($(this))})});