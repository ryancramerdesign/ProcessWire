(function(a){a.fn.asmSelect=function(b){var c={listType:"ol",sortable:false,highlight:false,animate:false,addItemTarget:"bottom",hideWhenAdded:false,hideWhenEmpty:false,debugMode:false,jQueryUI:true,hideDeleted:true,deletedOpacity:0.5,deletedPrepend:"-",sortLabel:'<span class="asmIcon asmIconSort">&#8597;</span>',removeLabel:'<span class="asmIcon asmIconRemove">&times;</span>',highlightAddedLabel:"Added: ",highlightRemovedLabel:"Removed: ",containerClass:"asmContainer",selectClass:"asmSelect",optionDisabledClass:"asmOptionDisabled",listClass:"asmList",listSortableClass:"asmListSortable",listItemClass:"asmListItem",listItemLabelClass:"asmListItemLabel",listItemDescClass:"asmListItemDesc",listItemStatusClass:"asmListItemStatus",listItemHandleClass:"asmListItemHandle",removeClass:"asmListItemRemove",editClass:"asmListItemEdit",highlightClass:"asmHighlight",deletedClass:"asmListItemDeleted",editLink:"",editLabel:'<span class="ui-icon ui-icon-extlink"></span>',editLinkOnlySelected:true,editLinkModal:true,editLinkButtonSelector:"form button.ui-button:visible"};a.extend(c,b);return this.each(function(l){var B=a(this);var t;var y;var n;var p=false;var e=false;var h=false;var o=0;function v(){while(a("#"+c.containerClass+l).size()>0){l++}y=a("<select></select>").addClass(c.selectClass).addClass(B.attr("class")).attr("name",c.selectClass+l).attr("id",c.selectClass+l);$selectRemoved=a("<select></select>");n=a("<"+c.listType+"></"+c.listType+">").addClass(c.listClass).attr("id",c.listClass+l);t=a("<div></div>").addClass(c.containerClass).attr("id",c.containerClass+l);x();y.change(m).click(C);B.change(r).wrap(t).before(y).before(n);if(c.sortable){z()}if(typeof a.browser!="undefined"&&typeof a.browser.msie!="undefined"){o=a.browser.msie?a.browser.version:0}if(o>0&&o<8){n.css("display","inline-block")}B.trigger("init");if(c.editLinkModal==="longclick"){n.on("longclick","a.asmEditLinkModalLongclick",w)}}function z(){n.sortable({items:"li."+c.listItemClass,axis:"y",cancel:"a.asmEditLinkModalLongclick",update:function(F,E){var D;$option=a("#"+E.item.attr("rel"));D=$option.attr("id");a(this).children("li").each(function(G){$option=a("#"+a(this).attr("rel"));B.append($option)});if(D){u(D,"sort")}},start:function(E,D){if(c.jQueryUI){D.item.addClass("ui-state-highlight")}},stop:function(E,D){if(c.jQueryUI){D.item.removeClass("ui-state-highlight")}}}).addClass(c.listSortableClass)}function m(D){if(o>0&&o<7&&!e){return}var E=a(this).children("option:selected").slice(0,1).attr("rel");s(E);e=false;u(E,"add")}function C(){e=true}function r(D){if(h){h=false;return}y.empty();n.empty();x();if(typeof a.browser!="undefined"){if(a.browser.opera){n.hide().fadeIn("fast")}}}function x(){p=true;var E=B.attr("title");var D=0;if(E===undefined){E=""}y.prepend("<option>"+E+"</option>");B.children("option").each(function(H){var G=a(this);var F;if(!G.attr("id")){G.attr("id","asm"+l+"option"+H)}F=G.attr("id");if(G.is(":selected")){s(F);i(F,true)}else{D++;i(F)}});if(!c.debugMode){B.hide()}g();if(c.hideWhenEmpty){if(D>0){y.show()}else{y.hide()}}p=false}function i(F,E){if(E==undefined){var E=false}var D=a("#"+F);var G=a("<option>"+D.html()+"</option>").val(D.val()).attr("rel",F);if(E){q(G)}y.append(G)}function g(){y.children(":eq(0)").attr("selected",true)}function q(D){D.addClass(c.optionDisabledClass).attr("selected",false).attr("disabled",true);if(c.hideWhenEmpty){if(D.siblings("[disabled!=true]").size()<2){y.hide()}}if(c.hideWhenAdded){D.hide()}if(o){y.hide().show()}}function f(D){D.removeClass(c.optionDisabledClass).attr("disabled",false);if(c.hideWhenEmpty){y.show()}if(c.hideWhenAdded){D.show()}if(o){y.hide().show()}}function s(I){var D=a("#"+I);if(!D){return}var G=a("<a></a>").attr("href","#").addClass(c.removeClass).prepend(c.removeLabel).click(function(){k(a(this).parent("li").attr("rel"));return false});var E=a("<span></span>").addClass(c.listItemLabelClass);var H=a("<span></span>").addClass(c.listItemStatusClass);if(D.attr("data-status")){H.html(D.attr("data-status"))}var F=a("<span></span>").addClass(c.listItemDescClass);if(c.editLink.length>0&&(D.is(":selected")||!c.editLinkOnlySelected)){var L=a("<a></a>").html(D.html()).attr("href",c.editLink.replace(/\{value\}/,D.val())).append(c.editLabel);if(c.editLinkModal==="longclick"){L.addClass("asmEditLinkModalLongclick")}else{if(c.editLinkModal){L.click(w)}}E.addClass(c.editClass).append(L);if(D.attr("data-desc")){var J=a("<a></a>").html(D.attr("data-desc")).attr("href",L.attr("href")).append(c.editLabel);F.addClass(c.editClass).append(J);if(c.editLinkModal==="longclick"){J.addClass("asmEditLinkModalLongclick")}else{if(c.editLinkModal){J.click(w)}}}}else{E.html(D.html());if(D.attr("data-desc")){F.html(D.attr("data-desc"))}}var K=a("<li></li>").attr("rel",I).addClass(c.listItemClass).append(E).append(F).append(H).append(G).hide();if(c.jQueryUI){K.addClass("ui-state-default").hover(function(){a(this).addClass("ui-state-hover").removeClass("ui-state-default")},function(){a(this).addClass("ui-state-default").removeClass("ui-state-hover")});if(c.sortable){if(D.attr("data-handle")){K.prepend(a(D.attr("data-handle")).addClass(c.listItemHandleClass))}else{K.prepend(a(c.sortLabel).addClass(c.listItemHandleClass))}}}if(!p){if(D.is(":selected")){return}D.attr("selected",true)}if(c.addItemTarget=="top"&&!p){n.prepend(K);if(c.sortable){B.prepend(D)}}else{n.append(K);if(c.sortable){B.append(D)}}d(K);q(a("[rel="+I+"]",y));if(!p){A(K,c.highlightAddedLabel);g();if(c.sortable){n.sortable("refresh")}}}function d(D){if(c.animate&&!p){D.animate({opacity:"show",height:"show"},100,"swing",function(){D.animate({height:"+=2px"},50,"swing",function(){D.animate({height:"-=2px"},25,"swing")})})}else{D.show()}}function k(G,D){var E=a("#"+G);if(c.hideDeleted){if(D==undefined){var D=true}E.attr("selected",false);$item=n.children("li[rel="+G+"]");j($item);f(a("[rel="+G+"]",c.removeWhenAdded?$selectRemoved:y));if(D){A($item,c.highlightRemovedLabel)}}else{$item=n.children("li[rel="+G+"]");var F=E.attr("value");if(F=="undefined"){F=E.text()}if($item.hasClass(c.deletedClass)){$item.removeClass(c.deletedClass);if(c.deletedOpacity!=1){$item.css("opacity",1)}E.attr("value",F.substring(c.deletedPrepend.length))}else{$item.addClass(c.deletedClass);if(c.deletedOpacity!=1){$item.css("opacity",c.deletedOpacity)}E.attr("value",c.deletedPrepend+F)}}u(G,"drop")}function j(D){if(c.animate&&!p){$prevItem=D.prev("li");D.animate({opacity:"hide",height:"hide"},100,"linear",function(){$prevItem.animate({height:"-=2px"},50,"swing",function(){$prevItem.animate({height:"+=2px"},100,"swing")});D.remove()})}else{D.remove()}}function A(D,E){if(!c.highlight){return}y.next("#"+c.highlightClass+l).remove();var F=a("<span></span>").hide().addClass(c.highlightClass).attr("id",c.highlightClass+l).html(E+D.children("."+c.listItemLabelClass).slice(0,1).text());y.after(F);F.fadeIn("fast",function(){setTimeout(function(){F.fadeOut("slow",function(){a(this).remove()})},50)})}function u(E,D){h=true;$option=a("#"+E);B.trigger("change",[{option:$option,value:$option.val(),id:E,item:n.children("[rel="+E+"]"),type:D}])}function w(G){if(!c.editLinkModal){return true}var D=a(this).parents("."+c.listItemClass);var E=a(this).attr("href");var F=pwModalWindow(E,{},"medium");F.load(function(){var J=F.contents();var I=[];var H=0;J.find(c.editLinkButtonSelector).each(function(P){var O=a(this);var L=O.text();var N=true;var K=O.is(".ui-priority-secondary");for(var M=0;M<H;M++){if(L==I[M].text){N=false}}if(N){I[H]={text:L,"class":(K?"ui-priority-secondary":""),click:function(){if(O.attr("type")=="submit"){O.click();D.effect("highlight",{},500);var Q=J.find("#"+c.listItemStatusClass);if(Q.size()==0){Q=J.find(":input."+c.listItemStatusClass)}if(Q.size()>0){D.find("."+c.listItemStatusClass).html(Q.eq(0).val())}var R=J.find("#"+c.listItemDescClass);if(R.size()==0){R=J.find(":input."+c.listItemDescClass)}if(R.size()>0){R=R.eq(0);var S=D.find("."+c.listItemDescClass);var T=S.find("a");if(T.size()>0){T.html(R.val())}else{S.html(R.val())}}}F.dialog("close")}};H++}O.hide()});F.setButtons(I)});return false}v()})}})(jQuery);