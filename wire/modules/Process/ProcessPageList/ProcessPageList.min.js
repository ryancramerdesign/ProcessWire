function ProcessPageListInit(){if(ProcessWire.config.ProcessPageList){$("#"+ProcessWire.config.ProcessPageList.containerID).ProcessPageList(ProcessWire.config.ProcessPageList)}}$(document).ready(function(){ProcessPageListInit()});(function(a){a.fn.ProcessPageList=function(d){var e={mode:"",limit:35,rootPageID:0,showRootPage:true,selectedPageID:0,adminPageID:2,trashPageID:7,langID:0,selectAllowUnselect:false,selectShowPageHeader:true,selectShowPath:true,selectStartLabel:"Change",selectCancelLabel:"Cancel",selectSelectLabel:"Select",selectUnselectLabel:"Unselect",moreLabel:"More",trashLabel:"Trash",moveInstructionLabel:"Click and drag to move",selectSelectHref:"#",selectUnselectHref:"#",ajaxURL:ProcessWire.config.urls.admin+"page/list/",ajaxMoveURL:ProcessWire.config.urls.admin+"page/sort/",openPagination:0,openPageIDs:[],openPageData:{},speed:200,useHoverActions:false,hoverActionDelay:250,hoverActionFade:150,spinnerMarkup:"<span class='PageListLoading'><i class='ui-priority-secondary fa fa-fw fa-spin fa-spinner'></i></span>",labelName:""};var b=[];var g=false;var f=a("body").hasClass("modal");var c=a("body").hasClass("touch");a.extend(e,d);return this.each(function(m){var w=a(this);var F;var v=a(e.spinnerMarkup);var G=0;var i=0;function z(){F=a("<div class='PageListRoot'></div>");if(w.is(":input")){e.selectedPageID=w.val();if(!e.selectedPageID.length){e.selectedPageID=0}e.mode="select";w.before(F);D()}else{e.mode="actions";w.append(F);o(e.rootPageID>0?e.rootPageID:1,F,0,true)}if(e.useHoverActions&&!a("body").hasClass("touch-device")){F.addClass("PageListUseHoverActions");p()}}function p(){var J=null;var K=null;var I=null;function H(M){var N=M.find(".PageListActions");if(!N.is(":visible")||M.hasClass("PageListItemOpen")){M.addClass("PageListItemHover");N.css("display","inline").css("opacity",0).animate({opacity:1},e.hoverActionFade)}}function L(M){var N=M.find(".PageListActions");M.removeClass("PageListItemHover");if(N.is(":visible")){N.animate({opacity:0},e.hoverActionFade,function(){N.hide()})}}a(document).on("mouseover",".PageListItem",function(O){if(F.is(".PageListSorting")||F.is(".PageListSortSaving")){return}if(!a(this).children("a:first").is(":hover")){return}I=a(this);if(I.hasClass("PageListItemHover")){return}var M=a(this);if(J){clearTimeout(J)}var N=e.hoverActionDelay;J=setTimeout(function(){if(I.attr("class")==M.attr("class")){if(!I.children("a:first").is(":hover")){return}var P=a(".PageListItemHover");H(I);P.each(function(){L(a(this))})}},N)}).on("mouseout",".PageListItem",function(O){if(F.is(".PageListSorting")||F.is(".PageListSortSaving")){return}var M=a(this);if(M.hasClass("PageListItemOpen")){return}if(!M.hasClass("PageListItemHover")){return}var N=e.hoverActionDelay*0.7;K=setTimeout(function(){if(M.is(":hover")){return}if(M.attr("class")==I.attr("class")){return}L(M)},N)})}function D(){var H=a("<ul></ul>").addClass("PageListActions PageListSelectActions actions");var J=a("<p></p>").addClass("PageListSelectName");if(e.selectShowPageHeader){J.append(v)}var K=a("<a></a>").addClass("PageListSelectActionToggle").attr("href","#").text(e.selectStartLabel).click(function(){if(a(this).text()==e.selectStartLabel){o(e.rootPageID>0?e.rootPageID:1,F,0,true);a(this).text(e.selectCancelLabel)}else{F.children(".PageList").slideUp(e.speed,function(){a(this).remove()});a(this).text(e.selectStartLabel)}return false});H.append(a("<li></li>").append(K));F.append(a("<div></div>").addClass("PageListSelectHeader").append(J).append(H));if(e.selectShowPageHeader){var I=e.ajaxURL+"?id="+e.selectedPageID+"&render=JSON&start=0&limit=0&lang="+e.langID+"&mode="+e.mode;if(e.labelName.length){I+="&labelName="+e.labelName}a.getJSON(I,function(N){var L="";if(e.selectShowPath){L=N.page.path;if(L.substring(-1)=="/"){L=L.substring(0,L.length-1)}L=L.substring(0,L.lastIndexOf("/")+1);L='<span class="detail">'+L+"</span> "}var M=e.selectedPageID>0?L+N.page.label:"";F.children(".PageListSelectHeader").find(".PageListSelectName").html(M)})}}function y(){g=false}function A(H,I,O,S){var Q=9;var J=Math.ceil(S/O);i=I>=O?Math.floor(I/O):0;if(i==0){G=0}else{if((i-Q+1)>G){G=i-Math.floor(Q/2)}else{if(G>0&&i==G){G=i-Math.ceil(Q/2)}}}if(G>J-Q){G=J-Q}if(G<0){G=0}var P=a("<ul></ul>").addClass("PageListPagination").data("paginationInfo",{start:I,limit:O,total:S});var R=function(ab){var V=a(this).parents("ul.PageListPagination");var aa=V.data("paginationInfo");if(!aa){return false}var ac=parseInt(a(this).attr("href"))*aa.limit;if(ac===NaN){ac=0}var W=A(H,ac,aa.limit,aa.total);var Y=a(e.spinnerMarkup);var Z=a("<li>&nbsp;</li>").append(Y.hide());V.siblings(".PageList").remove();V.replaceWith(W);W.append(Z);Y.fadeIn("fast");var X=W.siblings().css("opacity",0.5);o(H,W.parent(),a(this).attr("href")*aa.limit,false,false,true,function(){Y.fadeOut("fast",function(){Z.remove()});W.parent(".PageList").prev(".PageListItem").data("start",ac);h()});return false};var N=null;var K=null;for(var U=G,L=0;U<J;U++,L++){var M=a("<a></a>").html(U+1).attr("href",U).addClass("ui-state-default");var T=a("<li></li>").addClass("PageListPagination"+L).append(M);if(U==i){T.addClass("PageListPaginationCurrent").find("a").removeClass("ui-state-default").addClass("ui-state-active")}P.append(T);if(!K){K=T.clone().removeClass("PageListPaginationCurrent ui-state-active");K.find("a").removeClass("ui-state-active").addClass("ui-state-default")}if(!N){N=K.clone().removeClass("ui-state-default").html("&hellip;")}if(L>=Q&&U<J){$lastItem=K.clone();$lastItem.find("a").text(J).attr("href",J-1);P.append(N.clone()).append($lastItem);break}}if(G>0){$firstItem=K.clone();$firstItem.find("a").text("1").attr("href","0").click(R);P.prepend(N.clone()).prepend($firstItem)}if(i+1<J){$nextBtn=K.clone();$nextBtn.find("a").html("<i class='fa fa-angle-right'></i>").attr("href",i+1);P.append($nextBtn)}if(i>0){$prevBtn=K.clone();$prevBtn.find("a").attr("href",i-1).html("<i class='fa fa-angle-left'></i>");P.prepend($prevBtn)}P.find("a").click(R).hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")});return P}function o(I,L,J,N,Q,K,P){if(Q==undefined){Q=true}if(K==undefined){K=false}var M=function(V){if(V&&V.error){alert(V.message);v.hide();g=false;return}var R=l(a(V.children));var U=V.start+V.limit;if(V.page.numChildren>U){var T=a("<a></a>").attr("href",U).data("pageId",I).text(e.moreLabel).click(C);R.append(a("<ul></ul>").addClass("PageListActions actions").append(a("<li></li>").addClass("PageListActionMore").append(T)))}if(Q&&(V.page.numChildren>U||V.start>0)){R.prepend(A(I,V.start,V.limit,V.page.numChildren))}R.hide();if(N){var W;W=l(a(V.page));if(e.showRootPage){W.children(".PageListItem").addClass("PageListItemOpen")}else{W.children(".PageListItem").hide().parent(".PageList").addClass("PageListRootHidden")}W.append(R);L.append(W)}else{if(L.is(".PageList")){var S=R.children(".PageListItem, .PageListActions");if(K){L.children(".PageListItem, .PageListActions").replaceWith(S)}else{L.append(S)}}else{L.after(R)}}if(v.parent().is(".PageListRoot")){v.hide()}else{v.fadeOut("fast")}if(K){R.show();y();if(P!=undefined){P()}}else{R.slideDown(e.speed,function(){y();if(P!=undefined){P()}})}R.prev(".PageListItem").data("start",V.start);L.removeClass("PageListForceReload")};if(!K){L.append(v.fadeIn("fast"))}var O=I+"-"+J;if(typeof e.openPageData[O]!="undefined"&&!L.hasClass("PageListID7")&&!L.hasClass("PageListForceReload")){M(e.openPageData[O]);return}var H=e.ajaxURL+"?id="+I+"&render=JSON&start="+J+"&lang="+e.langID+"&open="+e.openPageIDs[0]+"&mode="+e.mode;if(e.labelName.length){H+="&labelName="+e.labelName}a.getJSON(H).done(function(S,T,R){M(S)}).fail(function(R,T,S){M({error:1,message:!R.status?e.ajaxNetworkError:e.ajaxUnknownError})})}function l(H){var J=a("<div></div>").addClass("PageList");var I=J;H.each(function(L,K){I.append(k(K))});t(I);return J}function t(H){a("a.PageListPage",H).click(u);a(".PageListActionMove a",H).click(j);a(".PageListActionSelect a",H).click(B);a(".PageListTriggerOpen:not(.PageListID1) > a.PageListPage",H).click();a(".PageListActionExtras > a:not(.clickExtras)",H).addClass("clickExtras").on("click",q)}function k(N){var M=a("<div></div>").data("pageId",N.id).addClass("PageListItem").addClass("PageListTemplate_"+N.template);var L=a("<a></a>").attr("href","#").attr("title",N.path).html(N.label).addClass("PageListPage label");M.addClass("PageListID"+N.id);if(N.status==0){M.addClass("PageListStatusOff disabled")}if(N.status&2048){M.addClass("PageListStatusUnpublished secondary")}if(N.status&1024){M.addClass("PageListStatusHidden secondary")}if(N.status&512){M.addClass("PageListStatusTemp secondary")}if(N.status&16){M.addClass("PageListStatusSystem")}if(N.status&8){M.addClass("PageListStatusSystem")}if(N.status&4){M.addClass("PageListStatusLocked")}if(N.addClass&&N.addClass.length){M.addClass(N.addClass)}if(N.type&&N.type.length>0){if(N.type=="System"){M.addClass("PageListStatusSystem")}}a(e.openPageIDs).each(function(P,O){O=parseInt(O);if(N.id==O){M.addClass("PageListTriggerOpen")}});M.append(L);var J=a("<span>"+(N.numChildren?N.numChildren:"")+"</span>").addClass("PageListNumChildren detail");M.append(J);if(N.note&&N.note.length){M.append(a("<span>"+N.note+"</span>").addClass("PageListNote detail"))}var K=a("<ul></ul>").addClass("PageListActions actions");var I=e.rootPageID==N.id?[]:[{name:e.selectSelectLabel,url:e.selectSelectHref}];if(e.mode=="actions"){I=N.actions}else{if(e.selectAllowUnselect){if(N.id==w.val()){I=[{name:e.selectUnselectLabel,url:e.selectUnselectHref}]}}}var H=null;a(I).each(function(S,Q){var O;if(Q.name==e.selectSelectLabel){O="Select"}else{if(Q.name==e.selectUnselectLabel){O="Select"}else{O=Q.cn}}var P=a("<a></a>").html(Q.name).attr("href",Q.url);if(!f&&!c){if(Q.cn=="Edit"){P.addClass("pw-modal pw-modal-large pw-modal-longclick");P.attr("data-buttons","#ProcessPageEdit > .Inputfields > .InputfieldSubmit .ui-button")}else{if(Q.cn=="View"){P.addClass("pw-modal pw-modal-large pw-modal-longclick")}}}if(typeof Q.extras!="undefined"){P.data("extras",Q.extras)}var R=a("<li></li>").addClass("PageListAction"+O).append(P);if(O=="Extras"){H=R}else{K.append(R)}});if(H){K.append(H);H.addClass("ui-priority-secondary")}M.append(K);return M}function q(O){var I=a(this);var K=I.data("extras");if(typeof K=="undefined"){return false}var R=I.closest(".PageListItem");var S=I.closest(".PageListActions");var M=null;var P=I.children("i.fa");var Q=S.find("li.PageListActionExtra");P.toggleClass("fa-flip-horizontal");if(Q.length){Q.fadeOut(100,function(){Q.remove()});return false}for(var J in K){var H=K[J];var N=a("<a />").addClass("PageListActionExtra PageListAction"+H.cn).attr("href",H.url).html(H.name);if(typeof H.ajax!="undefined"&&H.ajax==true){N.click(function(){R.find(".PageListActions").hide();var Z=a(e.spinnerMarkup);var W=a(this).attr("href");var V=W.match(/[\?&]action=([-_a-zA-Z0-9]+)/)[1];var U=parseInt(W.match(/[\?&]id=([0-9]+)/)[1]);var Y=a("#PageListContainer").attr("data-token-name");var X=a("#PageListContainer").attr("data-token-value");var T={action:V,id:U};T[Y]=X;R.append(Z);a.post(W+"&render=json",T,function(aa){if(aa.success){R.fadeOut("fast",function(){var ag=false;var ah=aa.remove;var af=aa.refreshChildren;var ad=false;if(typeof aa.child!="undefined"){ad=k(aa.child)}else{if(typeof aa.newChild!="undefined"){ad=k(aa.newChild);ag=true}}if(ad){var ab=a("<span />").addClass("notes").html(aa.message);ab.prepend("&nbsp;<i class='fa fa-check-square ui-priority-secondary'></i>&nbsp;");ad.append(ab);t(ad)}if(ag){Z.fadeOut("normal",function(){Z.remove()});ad.hide();R.after(ad);ad.slideDown()}else{if(ad){if(R.hasClass("PageListItemOpen")){ad.addClass("PageListItemOpen")}R.replaceWith(ad)}}R.fadeIn("fast",function(){setTimeout(function(){ab.fadeOut("normal",function(){if(ah){var ai=ad.closest(".PageList").prev(".PageListItem").children(".PageListNumChildren");if(ai.length){var aj=parseInt(ai.text());if(aj>0){ai.text(aj-1)}}ad.next(".PageList").fadeOut("fast");ad.fadeOut("fast",function(){ad.remove()})}else{ab.remove()}})},1000)});if(af){var ac=a(".PageListID"+af);if(ac.length){ac.addClass("PageListForceReload");var ae=ac.children("a.PageListPage");if(ac.hasClass("PageListItemOpen")){ae.click();setTimeout(function(){ae.click()},250)}else{ae.click()}}}})}else{Z.remove();alert(aa.message)}});return false})}else{}var L=a("<li />").addClass("PageListActionExtra PageListAction"+H.cn).append(N);N.hide();if(H.cn=="Trash"){R.addClass("trashable");M=L}else{S.append(L)}}if(M){S.append(M)}S.find(".PageListActionExtra a").fadeIn(50,function(){a(this).css("display","inline-block")});return false}function u(K){var O=a(this);var N=O.parent(".PageListItem");var M=N.data("pageId");if(g&&!N.hasClass("PageListTriggerOpen")){return false}if(F.is(".PageListSorting")||F.is(".PageListSortSaving")){return false}if(N.hasClass("PageListItemOpen")){var H=true;if(N.hasClass("PageListID1")&&!N.hasClass("PageListForceReload")&&e.mode!="select"){var I=a(this).closest(".PageListRoot").find(".PageListItemOpen:not(.PageListID1)");if(I.length){F.find(".PageListItemOpen:not(.PageListID1)").each(function(){a(this).children("a.PageListPage").click()});H=false}}if(H){N.removeClass("PageListItemOpen").next(".PageList").slideUp(e.speed,function(){a(this).remove()})}}else{N.addClass("PageListItemOpen");var J=parseInt(N.children(".PageListNumChildren").text());if(J>0||N.hasClass("PageListForceReload")){g=true;var L=E(M);o(M,N,L,false)}}if(e.mode!="select"){setTimeout(function(){h()},250)}return false}function E(L){var K=0;for(n=0;n<e.openPageIDs.length;n++){var I=e.openPageIDs[n];if(I.indexOf("-")==-1){continue}var J=e.openPageIDs[n].split("-");var H=parseInt(J[0]);if(H==L){K=parseInt(J[1]);break}}return K}function h(){b=[];a(".PageListItemOpen").each(function(){var I=a(this).data("pageId");var H=a(this).data("start");if(typeof H=="undefined"||H===null){H=0}else{var H=parseInt(H)}if(jQuery.inArray(I,b)==-1){b.push(I+"-"+H)}});a.cookie("pagelist_open",b)}function C(K){var M=a(this);var I=M.parent("li").parent("ul.PageListActions");var H=I.parent(".PageList");var L=M.data("pageId");var J=parseInt(M.attr("href"));o(L,H,J,false);I.remove();return false}function j(){if(g){return false}var N=a(this);if(a(".PageListItem:visible").length==1){N.css("text-decoration","line-through").addClass("ui-state-disabled");return false}var M=N.parent("li").parent("ul.PageListActions").parent(".PageListItem");if(M.hasClass("PageListItemOpen")){M.children(".PageListPage").click()}F.find(".PageListItemOpen").each(function(){var P=a(this).children(".PageListNumChildren").text();if(parseInt(P)>1&&a(this).next().find(".PageList:visible").size()==0){return}var O=a("<div></div>").addClass("PageListPlaceholder").addClass("PageList");O.append(a("<div></div>").addClass("PageListItem PageListPlaceholderItem").html("&nbsp;"));a(this).after(O)});var L={stop:r,helper:"PageListItemHelper",items:".PageListItem:not(.PageListItemOpen)",placeholder:"PageListSortPlaceholder",start:function(P,O){a(".PageListSortPlaceholder").css("width",O.item.children(".PageListPage").outerWidth()+"px")}};var I=F.children(".PageList").children(".PageList");var H=a("<a href='#'>"+e.selectCancelLabel+"</a>").click(function(){return s(M)});var K=M.children("ul.PageListActions");var J=a("<span class='PageListMoveNote detail'><i class='fa fa-fw fa-sort'></i> "+e.moveInstructionLabel+"<i class='fa fa-fw fa-angle-left'></i></span>");J.append(H);K.before(J);M.addClass("PageListSortItem");M.parent(".PageList").attr("id","PageListMoveFrom");F.addClass("PageListSorting");I.addClass("PageListSortingList").sortable(L);return false}function s(I){var H=F.find(".PageListSortingList");H.sortable("destroy").removeClass("PageListSortingList");I.removeClass("PageListSortItem").parent(".PageList").removeAttr("id");I.find(".PageListMoveNote").remove();F.find(".PageListPlaceholder").remove();F.removeClass("PageListSorting");return false}function x(K){var H=F.find(".PageListID"+e.trashPageID);if(!H.hasClass("PageListItemOpen")){F.removeClass("PageListSorting");H.children("a").click();F.addClass("PageListSorting")}var I=H.next(".PageList");if(I.length==0){I=a("<div class='PageList'></div>");H.after(I)}I.prepend(K);var J={item:K};r(null,J)}function r(N,S){var P=S.item;var K=P.children(".PageListPage");var I=parseInt(P.data("pageId"));var M=P.parent(".PageList");var Q=a("#PageListMoveFrom");var R=M.prev().is(".PageListItem")?M.prev():M.prev().prev();var O=parseInt(R.data("pageId"));var J=P.prev(".PageListItem");if(J.is(".PageListItemOpen")){return false}if(M.is(".PageListPlaceholder")){M.removeClass("PageListPlaceholder").children(".PageListPlaceholderItem").remove()}F.addClass("PageListSortSaving");s(P);P.append(v.fadeIn("fast"));var L="";M.children(".PageListItem").each(function(){L+=a(this).data("pageId")+","});var H={id:I,parent_id:O,sort:L};H[a("#PageListContainer").attr("data-token-name")]=a("#PageListContainer").attr("data-token-value");var T="unknown";a.post(e.ajaxMoveURL,H,function(W){v.fadeOut("fast");K.fadeOut("fast",function(){a(this).fadeIn("fast");P.removeClass("PageListSortItem");F.removeClass("PageListSorting")});if(W&&W.error){alert(W.message)}if(!M.is("#PageListMoveFrom")){var V=Q.prev(".PageListItem");var U=V.children(".PageListNumChildren");var Y=U.text().length>0?parseInt(U.text())-1:0;if(Y==0){Y="";Q.remove()}U.text(Y);var X=M.prev(".PageListItem");U=X.children(".PageListNumChildren");Y=U.text().length>0?parseInt(U.text())+1:1;U.text(Y)}Q.attr("id","");F.removeClass("PageListSortSaving")},"json");P.trigger("pageMoved");return true}function B(){var N=a(this);var M=N.parent("li").parent("ul.PageListActions").parent(".PageListItem");var L=M.data("pageId");var J=M.children(".PageListPage");var K=J.text();var I=J.attr("title");var H=F.children(".PageListSelectHeader");if(N.text()==e.selectUnselectLabel){L=0;K=""}if(L!=w.val()){w.val(L).change()}if(e.selectShowPageHeader){H.children(".PageListSelectName").text(K)}w.trigger("pageSelected",{id:L,url:I,title:K,a:J});H.find(".PageListSelectActionToggle").click();if(e.selectSelectHref=="#"){return false}return true}z()})}})(jQuery);