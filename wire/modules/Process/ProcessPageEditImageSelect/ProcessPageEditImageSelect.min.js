function enablePWImageDialogButtons(){var a=parent.jQuery(".ui-dialog-buttonpane");a.find("button").button("enable");return}function disablePWImageDialogButtons(){var a=parent.jQuery(".ui-dialog-buttonpane");a.find("button").button("disable");return}function closePWImageDialog(){parent.jQuery("iframe.ui-dialog-content").dialog("close")}function setupProcessSaveReloaded(b,a){if(a){var c=parent.jQuery("#"+b).offset().top-20;parent.jQuery("html, body").animate({scrollTop:c},1000,"swing");parent.jQuery("#"+b).hide();setTimeout(function(){parent.jQuery("#"+b).slideDown()},900)}else{parent.jQuery("#"+b).find("img").hide();setTimeout(function(){parent.jQuery("#"+b).find("img").fadeIn()},500)}closePWImageDialog()}function setupProcessSave(d,b,a){parent.jQuery("#wrap_Inputfield_"+d).trigger("reload");var c=false;parent.jQuery(".Inputfield").on("reloaded",function(){if(c){return}c=true;if(b.length>0){setTimeout(function(){setupProcessSaveReloaded(b,a)},250)}})}function refreshPageEditField(a){parent.jQuery("#wrap_Inputfield_"+a).trigger("reload")}function setupExecuteVariations(){$(document).on("click","input#delete_all",function(e){if($(this).is(":checked")){$("input.delete").attr("checked","checked")}else{$("input.delete").removeAttr("checked")}e.stopPropagation()});var d={type:"image",closeOnContentClick:true,closeBtnInside:true};$("a.preview").magnificPopup(d);var c=$("#varcnt_id");var a=c.val();var b=c.attr("data-cnt");window.parent.jQuery("#"+a).text(b)}function setupSelectedImage(){var f=false;var i=$("#selected_image_settings");var h=$("#selected_image_container");var b=$("#selected_image");var d=$("#selected_image_hidpi");var e;var c=parseInt($("#input_width").attr("min"));var g=parseInt($("#input_height").attr("min"));function a(k){var m=k.width();var w=$("#input_width").attr("max");var x=$("#input_height").attr("max");function v(y){if(y<(e-(e*0.2))){if(!d.is(":visible")){d.closest("label").fadeIn()}d.removeAttr("disabled")}else{d.attr("disabled","disabled");if(d.is(":visible")){d.closest("label").fadeOut()}}}function t(){var z=k.width();var B=k.height();var A=$("#wrap_link_original");if((B>=x||z>=w)&&i.hasClass("croppable")){z=w;B=x;$("#selected_image_link").removeAttr("checked");A.hide()}else{if(!A.is(":visible")){A.fadeIn();if(A.attr("data-was-checked")==1){A.attr("checked","checked")}}}$("#input_width").val(z);$("#input_height").val(B);k.attr("width",z);k.attr("height",B);v(z);var y=$("#latin");if(y.is(":visible")){y.height(B)}if(!i.hasClass("rte")){var C=$("#selected_image_resize");if(m<=z){C.hide()}else{if(!C.is(":visible")){C.fadeIn()}}}}function u(){k.resizable({aspectRatio:true,handles:"n, ne, e, se, s, sw, w",alsoResize:"#selected_image_container",maxWidth:w,maxHeight:x,minWidth:c<10?10:c,minHeight:g<10?10:g,start:function(){i.addClass("resizing_active")},stop:function(){k.attr("width",k.width()).attr("height",k.height());if(m!=k.width()){k.addClass("resized");if(!i.hasClass("rte")){var y=$("#selected_image_resize_yes");if(!y.is(":checked")){y.attr("checked","checked");$("#selected_image_resize_no").removeAttr("checked")}}}i.removeClass("resizing_active");if($("#resize_action").hasClass("on")){$("#resize_action").click().mouseout()}},resize:t});k.addClass("resizable_setup")}var l=null;function q(){var y=[{html:$("#button_crop").html(),click:function(){$("#button_crop").click()}},{html:$("#button_cancel_crop").html(),click:function(){$("#button_cancel_crop").click()},"class":"ui-priority-secondary"}];$(".show_when_crop").hide();$("#crop_action, .crop_trigger").click(function(E){var C=$(this).attr("data-recrop");if(C&&C.length>0){window.location.assign(C);return true}if(!i.hasClass("croppable")){return}if(f){return false}f=true;$("#selected_image_settings").addClass("cropping_active");$(".hide_when_crop").hide();$(".show_when_crop").show();if(k.hasClass("resizable_setup")){k.resizable("destroy")}var B={autoCrop:true,autoCropArea:0.35,zoomable:false,rotatable:false,maxWidth:k.attr("data-origwidth"),maxHeight:k.attr("data-origheight"),minCropBoxWidth:(c<2?0:c),minCropBoxHeight:(g<2?0:g),minWidth:(c<2?0:c),minHeight:(g<2?0:g),done:function(F){$("#crop_x").val(Math.floor(F.x));$("#crop_y").val(Math.floor(F.y));$("#crop_w").val(Math.floor(F.width));$("#crop_h").val(Math.floor(F.height));l=F}};var D=k.attr("data-crop");if(D&&D.length>0){D=D.split(",");B.data={x:D[0],y:D[1],width:D[2],height:D[3]};setTimeout(function(){disablePWImageDialogButtons(y)},1000)}else{disablePWImageDialogButtons(y)}k.cropper(B);setTimeout(function(){$(".cropper-canvas").width($(".cropper-container").width()).height($(".cropper-container").height())},500);var A=function(){var F={x:parseInt($("#crop_x").val()),y:parseInt($("#crop_y").val()),width:parseInt($("#crop_w").val()),height:parseInt($("#crop_h").val()),rotate:0};k.cropper("setData",F)};$("#crop_coordinates input").change(A)});function z(){k.cropper("destroy");$(".show_when_crop").hide();$(".hide_when_crop").show();f=false;$("#selected_image_settings").removeClass("cropping_active");u();enablePWImageDialogButtons()}$("#button_cancel_crop").click(function(){z()});$("#button_crop").click(function(){if(i.hasClass("processing")){return false}i.addClass("processing");return true});if(k.attr("data-crop")){$("#crop_action").click()}}function n(){if($(this).parents("#crop_coordinates").length){return}var y,z;if($(this).attr("id")=="input_width"){y=parseInt($(this).val());z=(y/k.attr("width"))*k.attr("height")}else{z=parseInt($(this).val());y=(z/k.attr("height"))*k.attr("width")}y=Math.floor(y);z=Math.floor(z);if(y<1||z<1||y==k.attr("width")||z==k.attr("height")||y>w||(c>1&&y<c)||(g>1&&z<g)){$("#input_width").val(k.attr("width"));$("#input_height").val(k.attr("height"));return false}u();$("#input_height").val(z);h.width(y).height(z);k.parent(".ui-wrapper").width(y).height(z);k.width(y).height(z).attr("width",y).attr("height",z);k.addClass("resized");t()}function o(){var z=k.is(".resized");k.attr("class",$(this).val());h.attr("class",$(this).val());if(z){k.addClass("resized")}var A=h.css("float");var y=$("#latin");if(A=="left"||A=="right"){if(!y.is(":visible")){y.height(h.height());y.fadeIn()}}else{if(y.is(":visible")){y.hide()}}u()}function p(){$("#max_action").click(function(){var z=parseInt(k.attr("data-origwidth"));if(z>w){z=w}$("#input_width").val(z).change()});$("#min_action").click(function(){var B=k.width();var z=k.height();var C=$(window).width()-30;var D=$(window).height()-$("#wrap_info").height()-20;var A=false;if(z>D){$("#input_height").val(D).change();A=true}if(B>C){$("#input_width").val(C).change();A=true}if(!A){$("#input_width").val(Math.ceil(B/2)).change()}});$("#align_left_action, #align_center_action, #align_right_action").click(function(){var A=$("#selected_image_class");var z=$(this).attr("data-label");if($(this).hasClass("on")){A.children("option").removeAttr("selected");$(this).removeClass("on")}else{$(this).siblings(".on").removeClass("on");A.children("option").removeAttr("selected");A.find("option[data-label="+z+"]").attr("selected","selected");$(this).addClass("on")}A.change()});var y=$("#selected_image_class").find("option[selected=selected]").attr("data-label");if(y){$("#action_icons").find("span[data-label="+y+"]").addClass("on")}$("#resize_action").hover(function(){if($(this).hasClass("on")){return}$("#resize_tips").show();$("#input_width, #input_height").addClass("ui-state-highlight")},function(){if($(this).hasClass("on")){return}$("#resize_tips").hide();$("#input_width, #input_height").removeClass("ui-state-highlight")}).click(function(){if($(this).hasClass("on")){$(this).removeClass("on");$("#input_width, #input_height").removeClass("ui-state-highlight")}else{$(this).addClass("on");$("#input_width, #input_height").addClass("ui-state-highlight")}});$("#description_action").click(function(){if($(this).hasClass("on")){$(this).removeClass("on");$("#wrap_description").slideUp("fast")}else{$(this).addClass("on");$("#wrap_description").slideDown("fast")}})}function j(){$("#selected_image_caption").change(function(){if(i.hasClass("cropping_active")){return}var y=$("#caption_preview");if($(this).is(":checked")){y.fadeIn()}else{if(y.is(":visible")){y.fadeOut()}}}).change()}function r(){var z=$(window).width()-30;var y=$(window).height()-($("#wrap_info").height()+80);if(k.width()>z){k.width(z).css("height","auto").removeAttr("height");k.removeAttr("height")}if(k.height()>y){k.removeAttr("width").css("width","auto").height(y)}h.width(k.width()).height(k.height())}var s=$("#wrap_info");s.css("min-height",s.height()+"px");s.children("span").css("min-height",s.height()+"px");$("#loading_button").hide();if(k.attr("data-fit")){r()}else{h.width(k.width()).height(k.height())}$("#selected_image_settings .input_pixels").change(n);$("#selected_image_class").change(o).change();e=k.attr("data-origwidth");t();q();p();j();$("button.submit_save_copy, button.submit_save_replace").click(function(){i.addClass("processing");disablePWImageDialogButtons()})}if(b.length>0){b=b.first();if(b.width()>0&&b.height()>0){a(b)}else{b.load(function(){b=$(this);a(b)})}}}$(document).ready(function(){var b=$("#page_id");if(b.length>0){var a=b.val();b.bind("pageSelected",function(c,d){if(d.id==a){return}window.location="./?id="+d.id+"&modal=1"})}if($("#selected_image").length>0){setupSelectedImage()}else{if($("#ImageVariations").length>0){setupExecuteVariations()}}enablePWImageDialogButtons();$(window).keydown(function(c){if(c.keyCode==13){c.preventDefault();return false}})});